{"remainingRequest":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\Home\\components\\ArticleList.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\Home\\components\\ArticleList.vue","mtime":1667380297575},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\babel.config.js","mtime":1664795892678},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCBBcnRpY2xlSXRlbSBmcm9tICJAL2NvbXBvbmVudHMvQXJ0aWNsZUl0ZW0udnVlIjsKaW1wb3J0IHsgZ2V0QWxsQXJ0aWNsZUFQSSwgZGlzbGlrZUFydGljbGVBUEksIHJlcG9ydEFydGljbGVBUEkgfSBmcm9tICJAL2FwaSI7CmltcG9ydCBOb3RpZnkgZnJvbSAiQC91aS9Ob3RpZnkuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgY29tcG9uZW50czogewogICAgQXJ0aWNsZUl0ZW0KICB9LAogIHByb3BzOiB7CiAgICAvLyBsaXN0OiBBcnJheQogICAgY2hhbm5lbElkOiBOdW1iZXIKICB9LAoKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgbGlzdDogW10sCiAgICAgIC8v5paH56ug5YiX6KGo5pWw57uECiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBmaW5pc2hlZDogZmFsc2UsCiAgICAgIHRoZVRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLAogICAgICBpc0xvYWRpbmc6IGZhbHNlCiAgICB9OwogIH0sCgogIGFzeW5jIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldEFydGljbGVMaXN0Rm4oKTsKICB9LAoKICBtZXRob2RzOiB7CiAgICAvLyDkuIrmi4nliqDovb3mm7TlpJoKICAgIGFzeW5jIG9uTG9hZCgpIHsKICAgICAgdGhpcy5nZXRBcnRpY2xlTGlzdEZuKCk7CiAgICB9LAoKICAgIGFzeW5jIGdldEFydGljbGVMaXN0Rm4oKSB7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGdldEFsbEFydGljbGVBUEkoewogICAgICAgIGNoYW5uZWxfaWQ6IHRoaXMuY2hhbm5lbElkLAogICAgICAgIHRpbWVzdGFtcDogdGhpcy50aGVUaW1lCiAgICAgIH0pOwogICAgICB0aGlzLmxpc3QgPSBbLi4udGhpcy5saXN0LCAuLi5yZXMuZGF0YS5kYXRhLnJlc3VsdHNdOwogICAgICB0aGlzLnRoZVRpbWUgPSByZXMuZGF0YS5kYXRhLnByZV90aW1lc3RhbXA7CiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOyAvL+WmguaenOS4jeWFs++8jOW6lemDqOS4gOebtOaYr+WKoOi9veeKtuaAge+8jOS4jeS8muWGjeinpuWPkW9ubG9hZOS6i+S7tgoKICAgICAgaWYgKHJlcy5kYXRhLmRhdGEucHJlX3RpbWVzdGFtcCA9PT0gbnVsbCkgewogICAgICAgIC8v5pys5qyh6K+35rGC55qE5pyA5ZCO5LiA6aG15pWw5o2u77yM5rKh5pyJ5pu05aSa5pWw5o2u5LqGCiAgICAgICAgdGhpcy5maW5pc2hlZCA9IHRydWU7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIOmhtumDqOWKoOi9veeKtuaAgeaUueS4umZhbHNlCgoKICAgICAgdGhpcy5pc0xvYWRpbmcgPSBmYWxzZTsKICAgIH0sCgogICAgLy8g5LiL5ouJ5Yi35pawCiAgICBhc3luYyBvblJlZnJlc2goKSB7CiAgICAgIHRoaXMubGlzdCA9IFtdOwogICAgICB0aGlzLnRoZVRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTsKICAgICAgdGhpcy5nZXRBcnRpY2xlTGlzdEZuKCk7CiAgICB9LAoKICAgIC8vIOWPjemmiC3kuI3mhJ/lhbTotqMKICAgIGFzeW5jIGRpc2xpa2VGbihpZCkgewogICAgICAvLyB0cnkrY2F0Y2jmjZXojrflkIzmraXku6PnoIHnmoTlvILluLgKICAgICAgdHJ5IHsKICAgICAgICBhd2FpdCBkaXNsaWtlQXJ0aWNsZUFQSSh7CiAgICAgICAgICBhcnRJZDogaWQKICAgICAgICB9KTsgLy8gY29uc29sZS5sb2coaWQpOwogICAgICAgIC8vIGNvbnNvbGUubG9nKHJlcyk7CgogICAgICAgIE5vdGlmeSh7CiAgICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgICBtZXNzYWdlOiAi5Y+N6aaI5oiQ5YqfIgogICAgICAgIH0pOwogICAgICAgIGNvbnNvbGUubG9nKCLmiJDlip/kuoYiKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZygi5aSx6LSl5LqGIik7CiAgICAgIH0KICAgIH0sCgogICAgLy8g5Y+N6aaILeS4vuaKpeaWh+eroAogICAgYXN5bmMgcmVwb3J0Rm4oaWQsIHZhbHVlKSB7CiAgICAgIGF3YWl0IHJlcG9ydEFydGljbGVBUEkoewogICAgICAgIGFydElkOiBpZCwKICAgICAgICB0eXBlOiB2YWx1ZQogICAgICB9KTsKICAgICAgTm90aWZ5KHsKICAgICAgICB0eXBlOiAic3VjY2VzcyIsCiAgICAgICAgbWVzc2FnZTogIuS4vuaKpeaIkOWKnyIKICAgICAgfSk7CiAgICB9LAoKICAgIC8vIOaWh+eroC3ngrnlh7vkuovku7Yt6Lez6L2s5Yiw5paH56ug6K+m5oOFCiAgICBpdGVtQ2xpY2tGbihpZCkgewogICAgICAvLyBjb25zb2xlLmxvZygiMTIzIik7CiAgICAgIHRoaXMuJHJvdXRlci5wdXNoKHsKICAgICAgICBwYXRoOiBgL2RldGFpbD9hcnRfaWQ9JHtpZH1gCiAgICAgIH0pOwogICAgfQoKICB9Cn07"},{"version":3,"mappings":";AA6BA;AACA;AACA;AAEA;EACAA;IACAC;EADA,CADA;EAIAC;IACA;IACAC;EAFA,CAJA;;EAQAC;IACA;MACAC,QADA;MACA;MACAC,cAFA;MAGAC,eAHA;MAIAC,6BAJA;MAKAC;IALA;EAOA,CAhBA;;EAiBA;IACA;EACA,CAnBA;;EAoBAC;IACA;IACA;MACA;IACA,CAJA;;IAKA;MACA;QACAC,0BADA;QAEAC;MAFA;MAKA;MACA;MACA,qBARA,CAQA;;MAEA;QACA;QACA;QACA;MACA,CAdA,CAgBA;;;MACA;IACA,CAvBA;;IAyBA;IACA;MACA;MACA;MAEA;IACA,CA/BA;;IAiCA;IACA;MACA;MACA;QACA;UACAC;QADA,GADA,CAIA;QAEA;;QACAC;UAAAC;UAAAC;QAAA;QACAC;MACA,CATA,CASA;QACAA;MACA;IACA,CAhDA;;IAkDA;IACA;MACA;QACAJ,SADA;QAEAE;MAFA;MAIAD;QAAAC;QAAAC;MAAA;IACA,CAzDA;;IA0DA;IACAE;MACA;MACA;QACAC;MADA;IAGA;;EAhEA;AApBA","names":["components","ArticleItem","props","channelId","data","list","loading","finished","theTime","isLoading","methods","channel_id","timestamp","artId","Notify","type","message","console","itemClickFn","path"],"sourceRoot":"src/views/Home/components","sources":["ArticleList.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 问题1：网页刚打开，created和onload里面的请求同时发送，请求的都是最新数据 -->\r\n    <!-- 在onload中，两次一样的数据合并，数据重复，key重复了 -->\r\n    <!-- 原因：van-list组件，组件挂载时，默认就会判断一次是触底 -->\r\n    <!-- 解决办法1:list组件添加：:immediate-check=\"false\" 上来初始化时不用判定 -->\r\n    <!-- 2：在onload第一行加一个list数组长度判断 -->\r\n    <van-pull-refresh v-model=\"isLoading\" @refresh=\"onRefresh\">\r\n      <van-list\r\n        v-model=\"loading\"\r\n        :finished=\"finished\"\r\n        finished-text=\"没有更多了\"\r\n        @load=\"onLoad\"\r\n        :immediate-check=\"false\"\r\n        offset=\"50\"\r\n      >\r\n        <ArticleItem\r\n          v-for=\"obj in list\"\r\n          :key=\"obj.art_id\"\r\n          :artObj=\"obj\"\r\n          @dislikeEV=\"dislikeFn\"\r\n          @reportEV=\"reportFn\"\r\n          @click.native=\"itemClickFn(obj.art_id)\"\r\n        ></ArticleItem>\r\n      </van-list>\r\n    </van-pull-refresh>\r\n  </div>\r\n</template>\r\n<script>\r\nimport ArticleItem from \"@/components/ArticleItem.vue\";\r\nimport { getAllArticleAPI, dislikeArticleAPI, reportArticleAPI } from \"@/api\";\r\nimport Notify from \"@/ui/Notify.js\";\r\n\r\nexport default {\r\n  components: {\r\n    ArticleItem\r\n  },\r\n  props: {\r\n    // list: Array\r\n    channelId: Number\r\n  },\r\n  data() {\r\n    return {\r\n      list: [], //文章列表数组\r\n      loading: false,\r\n      finished: false,\r\n      theTime: new Date().getTime(),\r\n      isLoading: false\r\n    };\r\n  },\r\n  async created() {\r\n    this.getArticleListFn();\r\n  },\r\n  methods: {\r\n    // 上拉加载更多\r\n    async onLoad() {\r\n      this.getArticleListFn();\r\n    },\r\n    async getArticleListFn() {\r\n      const res = await getAllArticleAPI({\r\n        channel_id: this.channelId,\r\n        timestamp: this.theTime\r\n      });\r\n\r\n      this.list = [...this.list, ...res.data.data.results];\r\n      this.theTime = res.data.data.pre_timestamp;\r\n      this.loading = false; //如果不关，底部一直是加载状态，不会再触发onload事件\r\n\r\n      if (res.data.data.pre_timestamp === null) {\r\n        //本次请求的最后一页数据，没有更多数据了\r\n        this.finished = true;\r\n        return;\r\n      }\r\n\r\n      // 顶部加载状态改为false\r\n      this.isLoading = false;\r\n    },\r\n\r\n    // 下拉刷新\r\n    async onRefresh() {\r\n      this.list = [];\r\n      this.theTime = new Date().getTime();\r\n\r\n      this.getArticleListFn();\r\n    },\r\n\r\n    // 反馈-不感兴趣\r\n    async dislikeFn(id) {\r\n      // try+catch捕获同步代码的异常\r\n      try {\r\n        await dislikeArticleAPI({\r\n          artId: id\r\n        });\r\n        // console.log(id);\r\n\r\n        // console.log(res);\r\n        Notify({ type: \"success\", message: \"反馈成功\" });\r\n        console.log(\"成功了\");\r\n      } catch (error) {\r\n        console.log(\"失败了\");\r\n      }\r\n    },\r\n\r\n    // 反馈-举报文章\r\n    async reportFn(id, value) {\r\n      await reportArticleAPI({\r\n        artId: id,\r\n        type: value\r\n      });\r\n      Notify({ type: \"success\", message: \"举报成功\" });\r\n    },\r\n    // 文章-点击事件-跳转到文章详情\r\n    itemClickFn(id) {\r\n      // console.log(\"123\");\r\n      this.$router.push({\r\n        path: `/detail?art_id=${id}`\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"\">\r\n</style>"]}]}
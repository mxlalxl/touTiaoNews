{"remainingRequest":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js!D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue","mtime":1666937178287},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\babel.config.js","mtime":1664795892678},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJ2YW50L2VzL25vdGlmeS9zdHlsZS9sZXNzIjsKaW1wb3J0IF9Ob3RpZnkgZnJvbSAidmFudC9lcy9ub3RpZnkiOwppbXBvcnQgeyB1c2VyUHJvZmlsZUFQSSwgdXBkYXRlVXNlclBob3RvQVBJLCB1cGRhdGVVc2VyUHJvZmlsZUFQSSB9IGZyb20gIkAvYXBpIjsKaW1wb3J0IHsgZm9ybWF0ZURhdGUgfSBmcm9tICJAL3V0aWxzL2RheWpzLmpzIjsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJVc2VyRWRpdCIsCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBwcm9maWxlT2JqOiB7fSwKICAgICAgLy/nlKjmiLfln7rmnKzotYTmlpnlr7nosaEKICAgICAgc2hvdzogZmFsc2UsCiAgICAgIC8v5o6n5Yi25aeT5ZCN5L+u5pS55by55Ye65qGG55qE5pi+56S65LiO6ZqQ6JePCiAgICAgIGlucHV0VXNlck5hbWU6ICIiLAogICAgICAvL+S/ruaUueWnk+WQjei+k+WFpeahhueahOe7keWumuWAvAogICAgICBtaW5EYXRlOiBuZXcgRGF0ZSgxOTIwLCAwLCAxKSwKICAgICAgLy/mnIDlsI/ojIPlm7QKICAgICAgbWF4RGF0ZTogbmV3IERhdGUoKSwKICAgICAgLy/mnIDlpKfojIPlm7QKICAgICAgY3VycmVudERhdGU6IG5ldyBEYXRlKCksCiAgICAgIC8v5b2T5YmN5pe26Ze0CiAgICAgIGRhdGVUaW1lUGlja2VyU2hvdzogZmFsc2UKICAgIH07CiAgfSwKCiAgYXN5bmMgY3JlYXRlZCgpIHsKICAgIGNvbnN0IHJlcyA9IGF3YWl0IHVzZXJQcm9maWxlQVBJKCk7IC8vIGNvbnNvbGUubG9nKHJlcyk7CgogICAgdGhpcy5wcm9maWxlT2JqID0gcmVzLmRhdGEuZGF0YTsKICB9LAoKICBtZXRob2RzOiB7CiAgICAvLyDmlofku7bpgInmi6nmlLnlj5gt5LqL5Lu2CiAgICBhc3luYyBvbkZpbGVDaGFuZ2UoZSkgewogICAgICAvLyBjb25zb2xlLmxvZyhlLnRhcmdldC5maWxlc1swXSk7CiAgICAgIC8vIOeUqOaIt+ayoeaciemAieaLqeWbvueJh++8jOmYu+atouS7o+eggeW+gOS4i+i/kOihjAogICAgICBpZiAoZS50YXJnZXQuZmlsZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCB0aGVGZCA9IG5ldyBGb3JtRGF0YSgpOwogICAgICB0aGVGZC5hcHBlbmQoInBob3RvIiwgZS50YXJnZXQuZmlsZXNbMF0pOyAvL+ivt+axguS9k+mHjOWKoOWFpeiOt+WPluWIsOeahOWbvueJhwoKICAgICAgY29uc3QgcmVzID0gYXdhaXQgdXBkYXRlVXNlclBob3RvQVBJKHRoZUZkKTsgLy8gY29uc29sZS5sb2cocmVzKTsKCiAgICAgIHRoaXMucHJvZmlsZU9iai5waG90byA9IHJlcy5kYXRhLmRhdGEucGhvdG87CiAgICB9LAoKICAgIC8vIOS/ruaUueWktOWDjwogICAgaW1hZ2VDbGlja0ZuKCkgewogICAgICAvLyDmqKHmi5/moIfnrb7nmoTngrnlh7vkuovku7YKICAgICAgdGhpcy4kcmVmcy5pcHRGaWxlLmNsaWNrKCk7CiAgICB9LAoKICAgIC8vIOS/ruaUueWQjeensAogICAgbmFtZUNsaWNrRm4oKSB7CiAgICAgIHRoaXMuc2hvdyA9IHRydWU7CiAgICAgIHRoaXMuaW5wdXRVc2VyTmFtZSA9IHRoaXMucHJvZmlsZU9iai5uYW1lOwogICAgfSwKCiAgICAvLyDlhbPpl63lvLnmoYbliY3nmoTmk43kvZwKICAgIGFzeW5jIGJlZm9yZUNsb3NlRm4oYWN0aW9uLCBkb25lKSB7CiAgICAgIGlmIChhY3Rpb24gPT09ICJjb25maXJtIikgewogICAgICAgIC8vIOeCueS6huehruWumgogICAgICAgIGNvbnN0IHJlZyA9IC9eW2EtekEtWjAtOVx1NGUwMC1cdTlmYTVdezEsN30kLzsKCiAgICAgICAgaWYgKHJlZy50ZXN0KHRoaXMuaW5wdXRVc2VyTmFtZSkgPT09IHRydWUpIHsKICAgICAgICAgIC8vIOmAmui/h+agoemqjAogICAgICAgICAgYXdhaXQgdXBkYXRlVXNlclByb2ZpbGVBUEkoewogICAgICAgICAgICBuYW1lOiB0aGlzLmlucHV0VXNlck5hbWUKICAgICAgICAgIH0pOwogICAgICAgICAgdGhpcy5wcm9maWxlT2JqLm5hbWUgPSB0aGlzLmlucHV0VXNlck5hbWU7IC8v5pu05paw5oiQ5YqfLS3mlbDmja7lm57mmL7pobXpnaLkuIoKCiAgICAgICAgICBkb25lKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOayoemAmui/h+agoemqjAogICAgICAgICAgX05vdGlmeSh7CiAgICAgICAgICAgIHR5cGU6ICJ3YXJuaW5nIiwKICAgICAgICAgICAgbWVzc2FnZTogIuivt+i+k+WFpTEtN+S9jeeahOS4reiLseaVsOWtlyIKICAgICAgICAgIH0pOwoKICAgICAgICAgIGRvbmUoZmFsc2UpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDngrnlj5bmtogKICAgICAgICBkb25lKCk7IC8v6K6p5by556qX5YWz6ZetCiAgICAgIH0KICAgIH0sCgogICAgLy8g5pi+56S655So5oi355Sf5pelLeeUn+aXpeWNleWFg+agvAogICAgYmlydGhkYXlDbGlja0ZuKCkgewogICAgICB0aGlzLmRhdGVUaW1lUGlja2VyU2hvdyA9IHRydWU7CiAgICAgIHRoaXMuY3VycmVudERhdGUgPSBuZXcgRGF0ZSh0aGlzLnByb2ZpbGVPYmouYmlydGhkYXkpOwogICAgfSwKCiAgICAvLyDml6XmnJ/pgInmi6nlmagt5Y+W5raI5LqL5Lu2CiAgICBkYXRlQ2FuY2VsRm4oKSB7CiAgICAgIHRoaXMuZGF0ZVRpbWVQaWNrZXJTaG93ID0gZmFsc2U7CiAgICB9LAoKICAgIGFzeW5jIGNvbmZpcm1GbigpIHsKICAgICAgLy8g5pel5pyf6YCJ5oup5Zmo57uE5Lu26YeM5piv5pel5pyf5a+56LGh77yM6ICM5ZCO5Y+w6KaB55qE5piv5bm0LeaciC3ml6XlrZfnrKbkuLIKICAgICAgYXdhaXQgdXBkYXRlVXNlclByb2ZpbGVBUEkoewogICAgICAgIGJpcnRoZGF5OiBmb3JtYXRlRGF0ZSh0aGlzLmN1cnJlbnREYXRlKQogICAgICB9KTsKICAgICAgdGhpcy5kYXRlVGltZVBpY2tlclNob3cgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlT2JqLmJpcnRoZGF5ID0gZm9ybWF0ZURhdGUodGhpcy5jdXJyZW50RGF0ZSk7IC8v5pWw5o2u5Zue5pi+5Yiw6aG16Z2iCiAgICB9CgogIH0KfTs="},{"version":3,"mappings":";;AAsCA,SACAA,cADA,EAEAC,kBAFA,EAGAC,oBAHA,QAIA,OAJA;AAMA;AACA;EACAC,gBADA;;EAEAC;IACA;MACAC,cADA;MACA;MACAC,WAFA;MAEA;MACAC,iBAHA;MAGA;MACAC,6BAJA;MAIA;MACAC,mBALA;MAKA;MACAC,uBANA;MAMA;MACAC;IAPA;EASA,CAZA;;EAaA;IACA,mCADA,CAEA;;IACA;EACA,CAjBA;;EAkBAC;IACA;IACA;MACA;MACA;MACA;QACA;MACA;;MACA;MACAC,yCAPA,CAOA;;MAEA,4CATA,CAUA;;MACA;IACA,CAdA;;IAeA;IACAC;MACA;MACA;IACA,CAnBA;;IAoBA;IACAC;MACA;MACA;IACA,CAxBA;;IAyBA;IACA;MACA;QACA;QACA;;QACA;UACA;UACA;YACAZ;UADA;UAGA,0CALA,CAKA;;UACAa;QACA,CAPA,MAOA;UACA;UACA;YAAAC;YAAAC;UAAA;;UACAF;QACA;MACA,CAfA,MAeA;QACA;QACAA,OAFA,CAEA;MACA;IACA,CA9CA;;IA+CA;IACAG;MACA;MACA;IACA,CAnDA;;IAoDA;IACAC;MACA;IACA,CAvDA;;IAwDA;MACA;MACA;QACAC;MADA;MAGA;MACA,yDANA,CAMA;IACA;;EA/DA;AAlBA","names":["userProfileAPI","updateUserPhotoAPI","updateUserProfileAPI","name","data","profileObj","show","inputUserName","minDate","maxDate","currentDate","dateTimePickerShow","methods","theFd","imageClickFn","nameClickFn","done","type","message","birthdayClickFn","dateCancelFn","birthday"],"sourceRoot":"src/views/User","sources":["UserEdit.vue"],"sourcesContent":["<template>\r\n  <div class=\"user-edit-container\">\r\n    <!-- Header区域 -->\r\n    <van-nav-bar title=\"编辑资料\" left-arrow @click-left=\"$router.back()\"></van-nav-bar>\r\n\r\n    <!-- 用户资料 -->\r\n    <van-cell-group class=\"action-card\">\r\n      <van-cell title=\"头像\" is-link center>\r\n        <template #default>\r\n          <van-image round class=\"avatar\" :src=\"profileObj.photo\" @click=\"imageClickFn\"></van-image>\r\n          <!-- file选择框 -->\r\n          <input type=\"file\" ref=\"iptFile\" v-show=\"false\" accept=\"image/*\" @change=\"onFileChange\" />\r\n        </template>\r\n      </van-cell>\r\n      <van-cell title=\"名称\" is-link :value=\"profileObj.name\" @click=\"nameClickFn\"></van-cell>\r\n\r\n      <!-- 修改名称确认弹出框 -->\r\n      <van-dialog v-model=\"show\" title=\"标题\" show-cancel-button :before-close=\"beforeCloseFn\">\r\n        <input type=\"text\" v-model=\"inputUserName\" v-fofo />\r\n      </van-dialog>\r\n      <van-cell title=\"生日\" is-link :value=\"profileObj.birthday\" @click=\"birthdayClickFn\"></van-cell>\r\n\r\n      <!-- 时间选择器 -->\r\n      <van-popup v-model=\"dateTimePickerShow\" round position=\"bottom\" :style=\"{ height: '50%'}\">\r\n        <van-datetime-picker\r\n          v-model=\"currentDate\"\r\n          type=\"date\"\r\n          title=\"选择年月日\"\r\n          :min-date=\"minDate\"\r\n          :max-date=\"maxDate\"\r\n          @cancel=\"dateCancelFn\"\r\n          @confirm=\"confirmFn\"\r\n        />\r\n      </van-popup>\r\n    </van-cell-group>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  userProfileAPI,\r\n  updateUserPhotoAPI,\r\n  updateUserProfileAPI\r\n} from \"@/api\";\r\nimport { Notify } from \"vant\";\r\nimport { formateDate } from \"@/utils/dayjs.js\";\r\nexport default {\r\n  name: \"UserEdit\",\r\n  data() {\r\n    return {\r\n      profileObj: {}, //用户基本资料对象\r\n      show: false, //控制姓名修改弹出框的显示与隐藏\r\n      inputUserName: \"\", //修改姓名输入框的绑定值\r\n      minDate: new Date(1920, 0, 1), //最小范围\r\n      maxDate: new Date(), //最大范围\r\n      currentDate: new Date(), //当前时间\r\n      dateTimePickerShow: false\r\n    };\r\n  },\r\n  async created() {\r\n    const res = await userProfileAPI();\r\n    // console.log(res);\r\n    this.profileObj = res.data.data;\r\n  },\r\n  methods: {\r\n    // 文件选择改变-事件\r\n    async onFileChange(e) {\r\n      // console.log(e.target.files[0]);\r\n      // 用户没有选择图片，阻止代码往下运行\r\n      if (e.target.files.length === 0) {\r\n        return;\r\n      }\r\n      const theFd = new FormData();\r\n      theFd.append(\"photo\", e.target.files[0]); //请求体里加入获取到的图片\r\n\r\n      const res = await updateUserPhotoAPI(theFd);\r\n      // console.log(res);\r\n      this.profileObj.photo = res.data.data.photo;\r\n    },\r\n    // 修改头像\r\n    imageClickFn() {\r\n      // 模拟标签的点击事件\r\n      this.$refs.iptFile.click();\r\n    },\r\n    // 修改名称\r\n    nameClickFn() {\r\n      this.show = true;\r\n      this.inputUserName = this.profileObj.name;\r\n    },\r\n    // 关闭弹框前的操作\r\n    async beforeCloseFn(action, done) {\r\n      if (action === \"confirm\") {\r\n        // 点了确定\r\n        const reg = /^[a-zA-Z0-9\\u4e00-\\u9fa5]{1,7}$/;\r\n        if (reg.test(this.inputUserName) === true) {\r\n          // 通过校验\r\n          await updateUserProfileAPI({\r\n            name: this.inputUserName\r\n          });\r\n          this.profileObj.name = this.inputUserName; //更新成功--数据回显页面上\r\n          done();\r\n        } else {\r\n          // 没通过校验\r\n          Notify({ type: \"warning\", message: \"请输入1-7位的中英数字\" });\r\n          done(false);\r\n        }\r\n      } else {\r\n        // 点取消\r\n        done(); //让弹窗关闭\r\n      }\r\n    },\r\n    // 显示用户生日-生日单元格\r\n    birthdayClickFn() {\r\n      this.dateTimePickerShow = true;\r\n      this.currentDate = new Date(this.profileObj.birthday);\r\n    },\r\n    // 日期选择器-取消事件\r\n    dateCancelFn() {\r\n      this.dateTimePickerShow = false;\r\n    },\r\n    async confirmFn() {\r\n      // 日期选择器组件里是日期对象，而后台要的是年-月-日字符串\r\n      await updateUserProfileAPI({\r\n        birthday: formateDate(this.currentDate)\r\n      });\r\n      this.dateTimePickerShow = false;\r\n      this.profileObj.birthday = formateDate(this.currentDate); //数据回显到页面\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.user-edit-container {\r\n  padding-top: 46px;\r\n  .avatar {\r\n    width: 50px;\r\n    height: 50px;\r\n  }\r\n}\r\n/deep/ .van-dialog__content {\r\n  text-align: center;\r\n  input {\r\n    padding: 0;\r\n    border: none;\r\n    outline: none;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>"]}]}
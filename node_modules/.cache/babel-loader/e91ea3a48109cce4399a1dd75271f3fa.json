{"remainingRequest":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js!D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\ArticleDetail\\CommentList.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\ArticleDetail\\CommentList.vue","mtime":1666579629485},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\babel.config.js","mtime":1664795892678},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgY29tbWVudHNMaXN0QVBJLCBjb21tZW50RGlzTGlraW5nQVBJLCBjb21tZW50TGlraW5nQVBJLCBjb21tZW50U2VuZEFQSSB9IGZyb20gIkAvYXBpIjsKaW1wb3J0IHsgdGltZUFnbyB9IGZyb20gIkAvdXRpbHMvZGF5anMuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG9mZnNldDogbnVsbCwKICAgICAgY29tbWVudEFycjogW10sCiAgICAgIGlzU2hvd0NtdEJveDogdHJ1ZSwKICAgICAgdG90YWxDb3VudDogMCwKICAgICAgLy/or4TorrrmnaHmlbAKICAgICAgY29tVGV4dDogIiIsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBmaW5pc2hlZDogZmFsc2UsCiAgICAgIGxhc3RJZDogIiIKICAgIH07CiAgfSwKCiAgYXN5bmMgY3JlYXRlZCgpIHsKICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNvbW1lbnRzTGlzdEFQSSh7CiAgICAgIGlkOiB0aGlzLiRyb3V0ZS5xdWVyeS5hcnRfaWQKICAgIH0pOyAvLyBjb25zb2xlLmxvZyhyZXMpOwoKICAgIHRoaXMuY29tbWVudEFyciA9IHJlcy5kYXRhLmRhdGEucmVzdWx0czsKICAgIHRoaXMudG90YWxDb3VudCA9IHJlcy5kYXRhLmRhdGEudG90YWxfY291bnQ7CiAgICB0aGlzLmxhc3RJZCA9IHJlcy5kYXRhLmRhdGEubGFzdF9pZDsgLy/nlKjkuo7liIbpobUKICAgIC8vIOe9kemhteaJk+W8gC0t5rKh5pyJ6K+E6K6677yM6K6p5YW25pi+56S65rKh5pyJ5pu05aSa5LqGCgogICAgaWYgKHJlcy5kYXRhLmRhdGEucmVzdWx0cy5sZW5ndGggPT09IDApIHsKICAgICAgdGhpcy5maW5pc2hlZCA9IHRydWU7CiAgICB9CiAgfSwKCiAgbWV0aG9kczogewogICAgdGltZUFnbywKCiAgICBhc3luYyBsaWtlRm4oYm9vbCwgY29tbWVudE9iaikgewogICAgICBpZiAoYm9vbCA9PT0gdHJ1ZSkgewogICAgICAgIC8vIOeUqOaIt+eCueWcqOe6ouW/g++8jOWPlua2iOeCuei1ngogICAgICAgIGNvbW1lbnRPYmouaXNfbGlraW5nID0gZmFsc2U7CiAgICAgICAgYXdhaXQgY29tbWVudERpc0xpa2luZ0FQSSh7CiAgICAgICAgICBjb21JZDogY29tbWVudE9iai5jb21faWQKICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyAgIOeUqOaIt+eCueWcqOS6hueBsOW/g+S4ii0t54K56LWeCiAgICAgICAgY29tbWVudE9iai5pc19saWtpbmcgPSB0cnVlOwogICAgICAgIGF3YWl0IGNvbW1lbnRMaWtpbmdBUEkoewogICAgICAgICAgY29tSWQ6IGNvbW1lbnRPYmouY29tX2lkCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCgogICAgdG9nZ2xlU2hvd0ZuKCkgewogICAgICB0aGlzLmlzU2hvd0NtdEJveCA9IGZhbHNlOwogICAgfSwKCiAgICAvLyDor4Torrrmu5rliqjliLDpobbpg6gKICAgIGNvbW1lbnRDbGlja0ZuKCkgewogICAgICAvLyBqc+WBmuWKqOeUu++8muiuoeaXtuWZqOmXtOmalOaXtumXtO+8jOS/ruaUueebruagh+eKtuaAgeOAguWKqOeUu+WunueOsOeahEpT5Y6f55Sf5Luj56CB77yM5Zyo6YWN572u6LWE5paZdHh05paH5Lu2CiAgICAgIC8vIOavlOi+g+aWueS+v+eahOWKqOeUu++8muWOn+eUn+agh+etvi5zY3JvbGxJbnRvVmlldygpLOiuqeWOn+eUn+eahOagh+etvua7muWIsOWxj+W5leeahOacgOS4iumdogogICAgICAvLyDkuLrkvZXpgInmi6lsaWtlLWJveO+8jOS4jemAieesrOS4gOadoeivhOiuuu+8jOWboOS4uuS8muiiq+WktOmDqOWvvOiIquaMoeS9jwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCIubGlrZS1ib3giKS5zY3JvbGxJbnRvVmlldyh7CiAgICAgICAgYmVoYXZpb3I6ICJzbW9vdGgiCiAgICAgIH0pOwogICAgfSwKCiAgICAvLyDovpPlhaXmoYYtLeWkseWOu+eEpueCuQogICAgYmx1ckZuKCkgewogICAgICAvL+mXrumimO+8mueCueWHu+WPkeW4g+aMiemSru+8jOWPkeeOsOeCueWHu+S6i+S7tuS4jeaJp+ihjAogICAgICAvLyDljp/lm6DvvJrpq5jnmoTor4Torrrlrrnlmagt5Zyo54K55Ye75Y+R5biD55qE5LiA556s6Ze077yM6L6T5YWl5qGG5aSx5Y675LqG54Sm54K577yM6KKrdi1pZuWSjHYtZWxzZeenu+mZpOS6huaVtOS4quagh+etvgogICAgICAvLyDop6PlhrPvvJrlpLHljrvnhKbngrnml7bvvIzlj5jph4/lgLzvvIzlnKjmnIDlkI7miafooYwKICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgdGhpcy5pc1Nob3dDbXRCb3ggPSB0cnVlOwogICAgICB9LCAwKTsKICAgIH0sCgogICAgLy8g5Y+R5biD5oyJ6ZKuLeeCueWHu+S6i+S7tgogICAgYXN5bmMgc2VuZEZuKCkgewogICAgICAvLyAgIGNvbnNvbGUubG9nKHRoaXMuY29tVGV4dCk7CiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGNvbW1lbnRTZW5kQVBJKHsKICAgICAgICBpZDogdGhpcy4kcm91dGUucXVlcnkuYXJ0X2lkLAogICAgICAgIGNvbnRlbnQ6IHRoaXMuY29tVGV4dAogICAgICB9KTsKICAgICAgY29uc29sZS5sb2cocmVzKTsKICAgICAgdGhpcy5jb21tZW50QXJyLnVuc2hpZnQocmVzLmRhdGEuZGF0YS5uZXdfb2JqKTsKICAgICAgdGhpcy50b3RhbENvdW50Kys7CiAgICAgIHRoaXMuY29tVGV4dCA9ICIiOwogICAgICB0aGlzLmNvbW1lbnRDbGlja0ZuKCk7IC8v5rua5Yiw5Yiw56ys5LiA5p2h6K+E6K665aSECiAgICB9LAoKICAgIC8vIOWKoOi9veabtOWkmuivhOiuugogICAgYXN5bmMgb25Mb2FkKCkgewogICAgICBpZiAodGhpcy5jb21tZW50QXJyLmxlbmd0aCA+IDApIHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBjb21tZW50c0xpc3RBUEkoewogICAgICAgICAgaWQ6IHRoaXMuJHJvdXRlLnF1ZXJ5LmFydF9pZCwKICAgICAgICAgIC8v5paH56ugaWQKICAgICAgICAgIG9mZnNldDogdGhpcy5sYXN0SWQKICAgICAgICB9KTsgLy8gY29uc29sZS5sb2cocmVzKTsKCiAgICAgICAgdGhpcy5jb21tZW50QXJyID0gWy4uLnRoaXMuY29tbWVudEFyciwgLi4ucmVzLmRhdGEuZGF0YS5yZXN1bHRzXTsKICAgICAgICB0aGlzLnRvdGFsQ291bnQgPSByZXMuZGF0YS5kYXRhLnRvdGFsX2NvdW50OwogICAgICAgIHRoaXMubGFzdElkID0gcmVzLmRhdGEuZGF0YS5sYXN0X2lkOyAvL+eUqOS6juWIhumhtQoKICAgICAgICBpZiAodGhpcy5sYXN0SWQgPT09IG51bGwpIHsKICAgICAgICAgIC8vICAg5rKh5pyJ5LiL5LiA6aG15LqGCiAgICAgICAgICB0aGlzLmZpbmlzaGVkID0gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KfTs="},{"version":3,"mappings":"AAkEA,SACAA,eADA,EAEAC,mBAFA,EAGAC,gBAHA,EAIAC,cAJA,QAKA,OALA;AAMA;AACA;EACAC;IACA;MACAC,YADA;MAEAC,cAFA;MAGAC,kBAHA;MAIAC,aAJA;MAIA;MACAC,WALA;MAMAC,cANA;MAOAC,eAPA;MAQAC;IARA;EAUA,CAZA;;EAaA;IACA;MACAC;IADA,GADA,CAIA;;IACA;IACA;IACA,oCAPA,CAOA;IAEA;;IACA;MACA;IACA;EACA,CA1BA;;EA2BAC;IACAC,OADA;;IAEA;MACA;QACA;QACAC;QACA;UACAC;QADA;MAGA,CANA,MAMA;QACA;QACAD;QACA;UACAC;QADA;MAGA;IACA,CAhBA;;IAiBAC;MACA;IACA,CAnBA;;IAoBA;IACAC;MACA;MACA;MACA;MACAC;QACAC;MADA;IAGA,CA5BA;;IA6BA;IACAC;MACA;MACA;MACA;MACAC;QACA;MACA,CAFA,EAEA,CAFA;IAGA,CArCA;;IAuCA;IACA;MACA;MACA;QACAV,4BADA;QAEAW;MAFA;MAIAC;MACA;MACA;MACA;MACA,sBAVA,CAUA;IACA,CAnDA;;IAoDA;IACA;MACA;QACA;UACAZ,4BADA;UACA;UACAR;QAFA,GADA,CAKA;;QACA;QACA;QACA,oCARA,CAQA;;QACA;UACA;UACA;QACA;;QACA;MACA,CAdA,MAcA;QACA;MACA;IACA;;EAvEA;AA3BA","names":["commentsListAPI","commentDisLikingAPI","commentLikingAPI","commentSendAPI","data","offset","commentArr","isShowCmtBox","totalCount","comText","loading","finished","lastId","id","methods","timeAgo","commentObj","comId","toggleShowFn","commentClickFn","document","behavior","blurFn","setTimeout","content","console"],"sourceRoot":"src/views/ArticleDetail","sources":["CommentList.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 评论列表 -->\r\n    <div\r\n      class=\"cmt-list\"\r\n      :class=\"{'art-cmt-container-1': isShowCmtBox, 'art-cmt-container-2': !isShowCmtBox}\"\r\n    >\r\n      <van-list\r\n        v-model=\"loading\"\r\n        :finished=\"finished\"\r\n        finished-text=\"没有更多了\"\r\n        @load=\"onLoad\"\r\n        :immediate-check=\"false\"\r\n      >\r\n        <!-- 评论的item项 -->\r\n        <div class=\"cmt-item\" v-for=\"obj in commentArr\" :key=\"obj.com_id\">\r\n          <!-- 头部区域 -->\r\n          <div class=\"cmt-header\">\r\n            <!-- 头部左侧 -->\r\n            <div class=\"cmt-header-left\">\r\n              <img :src=\"obj.aut_photo\" alt class=\"avatar\" />\r\n              <span class=\"uname\">{{obj.aut_name}}</span>\r\n            </div>\r\n            <!-- 头部右侧 -->\r\n            <div class=\"cmt-header-right\">\r\n              <van-icon\r\n                name=\"like\"\r\n                size=\"16\"\r\n                color=\"red\"\r\n                v-if=\"obj.is_liking === true\"\r\n                @click=\"likeFn(true, obj)\"\r\n              ></van-icon>\r\n              <van-icon name=\"like-o\" size=\"16\" color=\"gray\" v-else @click=\"likeFn(false)\"></van-icon>\r\n            </div>\r\n          </div>\r\n          <!-- 主体区域 -->\r\n          <div class=\"cmt-body\">{{obj.content}}</div>\r\n          <!-- 尾部区域 -->\r\n          <div class=\"cmt-footer\">{{timeAgo(obj.pubdate)}}</div>\r\n        </div>\r\n      </van-list>\r\n    </div>\r\n\r\n    <!-- 发表评论容器 -->\r\n    <div>\r\n      <!-- 底部评论区域--短 --1 -->\r\n      <div class=\"add-cmt-box van-hairline--top\" v-if=\"isShowCmtBox === true\">\r\n        <van-icon name=\"arrow-left\" size=\"0.48rem\" @click=\"$router.back()\"></van-icon>\r\n        <div class=\"ipt-cmt-div\" @click=\"toggleShowFn\">发表评论</div>\r\n        <div class=\"icon-box\">\r\n          <van-badge :content=\"totalCount === 0? '':totalCount\" max=\"99\">\r\n            <van-icon name=\"comment-o\" size=\"0.533333334rem\" @click=\"commentClickFn\"></van-icon>\r\n          </van-badge>\r\n          <van-icon name=\"star-o\" size=\"0.533333334rem\"></van-icon>\r\n          <van-icon name=\"share-o\" size=\"0.533333334rem\"></van-icon>\r\n        </div>\r\n      </div>\r\n      <!-- 底部评论区域--长 -->\r\n      <div class=\"cmt-box van-hairline--top\" v-else>\r\n        <textarea placeholder=\"友善评论、理性发言、阳光心灵\" v-fofo @blur=\"blurFn\" v-model=\"comText\"></textarea>\r\n        <van-button type=\"default\" :disabled=\"comText.length === 0\" @click=\"sendFn\">发布</van-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  commentsListAPI,\r\n  commentDisLikingAPI,\r\n  commentLikingAPI,\r\n  commentSendAPI\r\n} from \"@/api\";\r\nimport { timeAgo } from \"@/utils/dayjs.js\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      offset: null,\r\n      commentArr: [],\r\n      isShowCmtBox: true,\r\n      totalCount: 0, //评论条数\r\n      comText: \"\",\r\n      loading: false,\r\n      finished: false,\r\n      lastId: \"\"\r\n    };\r\n  },\r\n  async created() {\r\n    const res = await commentsListAPI({\r\n      id: this.$route.query.art_id\r\n    });\r\n    // console.log(res);\r\n    this.commentArr = res.data.data.results;\r\n    this.totalCount = res.data.data.total_count;\r\n    this.lastId = res.data.data.last_id; //用于分页\r\n\r\n    // 网页打开--没有评论，让其显示没有更多了\r\n    if (res.data.data.results.length === 0) {\r\n      this.finished = true;\r\n    }\r\n  },\r\n  methods: {\r\n    timeAgo,\r\n    async likeFn(bool, commentObj) {\r\n      if (bool === true) {\r\n        // 用户点在红心，取消点赞\r\n        commentObj.is_liking = false;\r\n        await commentDisLikingAPI({\r\n          comId: commentObj.com_id\r\n        });\r\n      } else {\r\n        //   用户点在了灰心上--点赞\r\n        commentObj.is_liking = true;\r\n        await commentLikingAPI({\r\n          comId: commentObj.com_id\r\n        });\r\n      }\r\n    },\r\n    toggleShowFn() {\r\n      this.isShowCmtBox = false;\r\n    },\r\n    // 评论滚动到顶部\r\n    commentClickFn() {\r\n      // js做动画：计时器间隔时间，修改目标状态。动画实现的JS原生代码，在配置资料txt文件\r\n      // 比较方便的动画：原生标签.scrollIntoView(),让原生的标签滚到屏幕的最上面\r\n      // 为何选择like-box，不选第一条评论，因为会被头部导航挡住\r\n      document.querySelector(\".like-box\").scrollIntoView({\r\n        behavior: \"smooth\"\r\n      });\r\n    },\r\n    // 输入框--失去焦点\r\n    blurFn() {\r\n      //问题：点击发布按钮，发现点击事件不执行\r\n      // 原因：高的评论容器-在点击发布的一瞬间，输入框失去了焦点，被v-if和v-else移除了整个标签\r\n      // 解决：失去焦点时，变量值，在最后执行\r\n      setTimeout(() => {\r\n        this.isShowCmtBox = true;\r\n      }, 0);\r\n    },\r\n\r\n    // 发布按钮-点击事件\r\n    async sendFn() {\r\n      //   console.log(this.comText);\r\n      const res = await commentSendAPI({\r\n        id: this.$route.query.art_id,\r\n        content: this.comText\r\n      });\r\n      console.log(res);\r\n      this.commentArr.unshift(res.data.data.new_obj);\r\n      this.totalCount++;\r\n      this.comText = \"\";\r\n      this.commentClickFn(); //滚到到第一条评论处\r\n    },\r\n    // 加载更多评论\r\n    async onLoad() {\r\n      if (this.commentArr.length > 0) {\r\n        const res = await commentsListAPI({\r\n          id: this.$route.query.art_id, //文章id\r\n          offset: this.lastId\r\n        });\r\n        // console.log(res);\r\n        this.commentArr = [...this.commentArr, ...res.data.data.results];\r\n        this.totalCount = res.data.data.total_count;\r\n        this.lastId = res.data.data.last_id; //用于分页\r\n        if (this.lastId === null) {\r\n          //   没有下一页了\r\n          this.finished = true;\r\n        }\r\n        this.loading = false;\r\n      } else {\r\n        this.loading = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.cmt-list {\r\n  padding: 10px;\r\n  .cmt-item {\r\n    padding: 15px 0;\r\n    .cmt-item {\r\n      border-top: 1px solid #f8f8f8;\r\n    }\r\n    .cmt-header {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      .cmt-header-left {\r\n        display: flex;\r\n        align-items: center;\r\n        .avatar {\r\n          width: 40px;\r\n          height: 40px;\r\n          background-color: #f8f8f8;\r\n          border-radius: 50%;\r\n          margin-right: 15px;\r\n        }\r\n        .uname {\r\n          font-size: 12px;\r\n        }\r\n      }\r\n    }\r\n    .cmt-body {\r\n      font-size: 14px;\r\n      line-height: 28px;\r\n      text-indent: 2em;\r\n      margin-top: 6px;\r\n      word-break: break-all;\r\n    }\r\n    .cmt-footer {\r\n      font-size: 12px;\r\n      color: gray;\r\n      margin-top: 10px;\r\n    }\r\n  }\r\n}\r\n\r\n// 评论区域样式\r\n.art-cmt-container-1 {\r\n  padding-bottom: 76px;\r\n}\r\n.art-cmt-container-2 {\r\n  padding-bottom: 80px;\r\n}\r\n\r\n// 发布评论盒子--1\r\n.add-cmt-box {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  background-color: white;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  height: 76px;\r\n  line-height: 46px;\r\n  padding-left: 10px;\r\n  .ipt-cmt-div {\r\n    flex: 1;\r\n    border: 1px solid #efefef;\r\n    border-radius: 15px;\r\n    height: 30px;\r\n    font-size: 12px;\r\n    line-height: 30px;\r\n    padding-left: 15px;\r\n    margin-left: 10px;\r\n    background-color: #f8f8f8;\r\n  }\r\n  .icon-box {\r\n    width: 50%;\r\n    display: flex;\r\n    justify-content: space-evenly;\r\n    line-height: 0;\r\n  }\r\n}\r\n.child {\r\n  width: 20px;\r\n  height: 20px;\r\n  background: #f2f3f5;\r\n}\r\n\r\n// 发表评论的盒子---2\r\n.cmt-box {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 80px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  font-size: 12px;\r\n  padding-left: 10px;\r\n  box-sizing: border-box;\r\n  background-color: white;\r\n  textarea {\r\n    flex: 1;\r\n    height: 66%;\r\n    border: 1px solid #efefef;\r\n    background-color: #f8f8f8;\r\n    resize: none;\r\n    border-radius: 6px;\r\n    padding: 5px;\r\n  }\r\n  .van-button {\r\n    height: 100%;\r\n    border: none;\r\n  }\r\n}\r\n</style>"]}]}
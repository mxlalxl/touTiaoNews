{"remainingRequest":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue","mtime":1667379873340},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\babel.config.js","mtime":1664795892678},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHsgdXNlclByb2ZpbGVBUEksIHVwZGF0ZVVzZXJQaG90b0FQSSwgdXBkYXRlVXNlclByb2ZpbGVBUEkgfSBmcm9tICJAL2FwaSI7CmltcG9ydCBOb3RpZnkgZnJvbSAiQC91aS9Ob3RpZnkuanMiOwppbXBvcnQgeyBmb3JtYXRlRGF0ZSB9IGZyb20gIkAvdXRpbHMvZGF5anMuanMiOwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlVzZXJFZGl0IiwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHByb2ZpbGVPYmo6IHt9LAogICAgICAvL+eUqOaIt+WfuuacrOi1hOaWmeWvueixoQogICAgICBzaG93OiBmYWxzZSwKICAgICAgLy/mjqfliLblp5PlkI3kv67mlLnlvLnlh7rmoYbnmoTmmL7npLrkuI7pmpDol48KICAgICAgaW5wdXRVc2VyTmFtZTogIiIsCiAgICAgIC8v5L+u5pS55aeT5ZCN6L6T5YWl5qGG55qE57uR5a6a5YC8CiAgICAgIG1pbkRhdGU6IG5ldyBEYXRlKDE5MjAsIDAsIDEpLAogICAgICAvL+acgOWwj+iMg+WbtAogICAgICBtYXhEYXRlOiBuZXcgRGF0ZSgpLAogICAgICAvL+acgOWkp+iMg+WbtAogICAgICBjdXJyZW50RGF0ZTogbmV3IERhdGUoKSwKICAgICAgLy/lvZPliY3ml7bpl7QKICAgICAgZGF0ZVRpbWVQaWNrZXJTaG93OiBmYWxzZQogICAgfTsKICB9LAoKICBhc3luYyBjcmVhdGVkKCkgewogICAgY29uc3QgcmVzID0gYXdhaXQgdXNlclByb2ZpbGVBUEkoKTsgLy8gY29uc29sZS5sb2cocmVzKTsKCiAgICB0aGlzLnByb2ZpbGVPYmogPSByZXMuZGF0YS5kYXRhOwogIH0sCgogIG1ldGhvZHM6IHsKICAgIC8vIOaWh+S7tumAieaLqeaUueWPmC3kuovku7YKICAgIGFzeW5jIG9uRmlsZUNoYW5nZShlKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKGUudGFyZ2V0LmZpbGVzWzBdKTsKICAgICAgLy8g55So5oi35rKh5pyJ6YCJ5oup5Zu+54mH77yM6Zi75q2i5Luj56CB5b6A5LiL6L+Q6KGMCiAgICAgIGlmIChlLnRhcmdldC5maWxlcy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHRoZUZkID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIHRoZUZkLmFwcGVuZCgicGhvdG8iLCBlLnRhcmdldC5maWxlc1swXSk7IC8v6K+35rGC5L2T6YeM5Yqg5YWl6I635Y+W5Yiw55qE5Zu+54mHCgogICAgICBjb25zdCByZXMgPSBhd2FpdCB1cGRhdGVVc2VyUGhvdG9BUEkodGhlRmQpOyAvLyBjb25zb2xlLmxvZyhyZXMpOwoKICAgICAgdGhpcy5wcm9maWxlT2JqLnBob3RvID0gcmVzLmRhdGEuZGF0YS5waG90bzsKICAgIH0sCgogICAgLy8g5L+u5pS55aS05YOPCiAgICBpbWFnZUNsaWNrRm4oKSB7CiAgICAgIC8vIOaooeaLn+agh+etvueahOeCueWHu+S6i+S7tgogICAgICB0aGlzLiRyZWZzLmlwdEZpbGUuY2xpY2soKTsKICAgIH0sCgogICAgLy8g5L+u5pS55ZCN56ewCiAgICBuYW1lQ2xpY2tGbigpIHsKICAgICAgdGhpcy5zaG93ID0gdHJ1ZTsKICAgICAgdGhpcy5pbnB1dFVzZXJOYW1lID0gdGhpcy5wcm9maWxlT2JqLm5hbWU7CiAgICB9LAoKICAgIC8vIOWFs+mXreW8ueahhuWJjeeahOaTjeS9nAogICAgYXN5bmMgYmVmb3JlQ2xvc2VGbihhY3Rpb24sIGRvbmUpIHsKICAgICAgaWYgKGFjdGlvbiA9PT0gImNvbmZpcm0iKSB7CiAgICAgICAgLy8g54K55LqG56Gu5a6aCiAgICAgICAgY29uc3QgcmVnID0gL15bYS16QS1aMC05XHU0ZTAwLVx1OWZhNV17MSw3fSQvOwoKICAgICAgICBpZiAocmVnLnRlc3QodGhpcy5pbnB1dFVzZXJOYW1lKSA9PT0gdHJ1ZSkgewogICAgICAgICAgLy8g6YCa6L+H5qCh6aqMCiAgICAgICAgICBhd2FpdCB1cGRhdGVVc2VyUHJvZmlsZUFQSSh7CiAgICAgICAgICAgIG5hbWU6IHRoaXMuaW5wdXRVc2VyTmFtZQogICAgICAgICAgfSk7CiAgICAgICAgICB0aGlzLnByb2ZpbGVPYmoubmFtZSA9IHRoaXMuaW5wdXRVc2VyTmFtZTsgLy/mm7TmlrDmiJDlip8tLeaVsOaNruWbnuaYvumhtemdouS4igoKICAgICAgICAgIGRvbmUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgLy8g5rKh6YCa6L+H5qCh6aqMCiAgICAgICAgICBOb3RpZnkoewogICAgICAgICAgICB0eXBlOiAid2FybmluZyIsCiAgICAgICAgICAgIG1lc3NhZ2U6ICLor7fovpPlhaUxLTfkvY3nmoTkuK3oi7HmlbDlrZciCiAgICAgICAgICB9KTsKICAgICAgICAgIGRvbmUoZmFsc2UpOwogICAgICAgIH0KICAgICAgfSBlbHNlIHsKICAgICAgICAvLyDngrnlj5bmtogKICAgICAgICBkb25lKCk7IC8v6K6p5by556qX5YWz6ZetCiAgICAgIH0KICAgIH0sCgogICAgLy8g5pi+56S655So5oi355Sf5pelLeeUn+aXpeWNleWFg+agvAogICAgYmlydGhkYXlDbGlja0ZuKCkgewogICAgICB0aGlzLmRhdGVUaW1lUGlja2VyU2hvdyA9IHRydWU7CiAgICAgIHRoaXMuY3VycmVudERhdGUgPSBuZXcgRGF0ZSh0aGlzLnByb2ZpbGVPYmouYmlydGhkYXkpOwogICAgfSwKCiAgICAvLyDml6XmnJ/pgInmi6nlmagt5Y+W5raI5LqL5Lu2CiAgICBkYXRlQ2FuY2VsRm4oKSB7CiAgICAgIHRoaXMuZGF0ZVRpbWVQaWNrZXJTaG93ID0gZmFsc2U7CiAgICB9LAoKICAgIGFzeW5jIGNvbmZpcm1GbigpIHsKICAgICAgLy8g5pel5pyf6YCJ5oup5Zmo57uE5Lu26YeM5piv5pel5pyf5a+56LGh77yM6ICM5ZCO5Y+w6KaB55qE5piv5bm0LeaciC3ml6XlrZfnrKbkuLIKICAgICAgYXdhaXQgdXBkYXRlVXNlclByb2ZpbGVBUEkoewogICAgICAgIGJpcnRoZGF5OiBmb3JtYXRlRGF0ZSh0aGlzLmN1cnJlbnREYXRlKQogICAgICB9KTsKICAgICAgdGhpcy5kYXRlVGltZVBpY2tlclNob3cgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlT2JqLmJpcnRoZGF5ID0gZm9ybWF0ZURhdGUodGhpcy5jdXJyZW50RGF0ZSk7IC8v5pWw5o2u5Zue5pi+5Yiw6aG16Z2iCiAgICB9CgogIH0KfTs="},{"version":3,"mappings":"AAsCA,SACAA,cADA,EAEAC,kBAFA,EAGAC,oBAHA,QAIA,OAJA;AAKA;AACA;AACA;EACAC,gBADA;;EAEAC;IACA;MACAC,cADA;MACA;MACAC,WAFA;MAEA;MACAC,iBAHA;MAGA;MACAC,6BAJA;MAIA;MACAC,mBALA;MAKA;MACAC,uBANA;MAMA;MACAC;IAPA;EASA,CAZA;;EAaA;IACA,mCADA,CAEA;;IACA;EACA,CAjBA;;EAkBAC;IACA;IACA;MACA;MACA;MACA;QACA;MACA;;MACA;MACAC,yCAPA,CAOA;;MAEA,4CATA,CAUA;;MACA;IACA,CAdA;;IAeA;IACAC;MACA;MACA;IACA,CAnBA;;IAoBA;IACAC;MACA;MACA;IACA,CAxBA;;IAyBA;IACA;MACA;QACA;QACA;;QACA;UACA;UACA;YACAZ;UADA;UAGA,0CALA,CAKA;;UACAa;QACA,CAPA,MAOA;UACA;UACAC;YAAAC;YAAAC;UAAA;UACAH;QACA;MACA,CAfA,MAeA;QACA;QACAA,OAFA,CAEA;MACA;IACA,CA9CA;;IA+CA;IACAI;MACA;MACA;IACA,CAnDA;;IAoDA;IACAC;MACA;IACA,CAvDA;;IAwDA;MACA;MACA;QACAC;MADA;MAGA;MACA,yDANA,CAMA;IACA;;EA/DA;AAlBA","names":["userProfileAPI","updateUserPhotoAPI","updateUserProfileAPI","name","data","profileObj","show","inputUserName","minDate","maxDate","currentDate","dateTimePickerShow","methods","theFd","imageClickFn","nameClickFn","done","Notify","type","message","birthdayClickFn","dateCancelFn","birthday"],"sourceRoot":"src/views/User","sources":["UserEdit.vue"],"sourcesContent":["<template>\r\n  <div class=\"user-edit-container\">\r\n    <!-- Header区域 -->\r\n    <van-nav-bar title=\"编辑资料\" left-arrow @click-left=\"$router.back()\"></van-nav-bar>\r\n\r\n    <!-- 用户资料 -->\r\n    <van-cell-group class=\"action-card\">\r\n      <van-cell title=\"头像\" is-link center>\r\n        <template #default>\r\n          <van-image round class=\"avatar\" :src=\"profileObj.photo\" @click=\"imageClickFn\"></van-image>\r\n          <!-- file选择框 -->\r\n          <input type=\"file\" ref=\"iptFile\" v-show=\"false\" accept=\"image/*\" @change=\"onFileChange\" />\r\n        </template>\r\n      </van-cell>\r\n      <van-cell title=\"名称\" is-link :value=\"profileObj.name\" @click=\"nameClickFn\"></van-cell>\r\n\r\n      <!-- 修改名称确认弹出框 -->\r\n      <van-dialog v-model=\"show\" title=\"标题\" show-cancel-button :before-close=\"beforeCloseFn\">\r\n        <input type=\"text\" v-model=\"inputUserName\" v-fofo />\r\n      </van-dialog>\r\n      <van-cell title=\"生日\" is-link :value=\"profileObj.birthday\" @click=\"birthdayClickFn\"></van-cell>\r\n\r\n      <!-- 时间选择器 -->\r\n      <van-popup v-model=\"dateTimePickerShow\" round position=\"bottom\" :style=\"{ height: '50%'}\">\r\n        <van-datetime-picker\r\n          v-model=\"currentDate\"\r\n          type=\"date\"\r\n          title=\"选择年月日\"\r\n          :min-date=\"minDate\"\r\n          :max-date=\"maxDate\"\r\n          @cancel=\"dateCancelFn\"\r\n          @confirm=\"confirmFn\"\r\n        />\r\n      </van-popup>\r\n    </van-cell-group>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  userProfileAPI,\r\n  updateUserPhotoAPI,\r\n  updateUserProfileAPI\r\n} from \"@/api\";\r\nimport Notify from \"@/ui/Notify.js\";\r\nimport { formateDate } from \"@/utils/dayjs.js\";\r\nexport default {\r\n  name: \"UserEdit\",\r\n  data() {\r\n    return {\r\n      profileObj: {}, //用户基本资料对象\r\n      show: false, //控制姓名修改弹出框的显示与隐藏\r\n      inputUserName: \"\", //修改姓名输入框的绑定值\r\n      minDate: new Date(1920, 0, 1), //最小范围\r\n      maxDate: new Date(), //最大范围\r\n      currentDate: new Date(), //当前时间\r\n      dateTimePickerShow: false\r\n    };\r\n  },\r\n  async created() {\r\n    const res = await userProfileAPI();\r\n    // console.log(res);\r\n    this.profileObj = res.data.data;\r\n  },\r\n  methods: {\r\n    // 文件选择改变-事件\r\n    async onFileChange(e) {\r\n      // console.log(e.target.files[0]);\r\n      // 用户没有选择图片，阻止代码往下运行\r\n      if (e.target.files.length === 0) {\r\n        return;\r\n      }\r\n      const theFd = new FormData();\r\n      theFd.append(\"photo\", e.target.files[0]); //请求体里加入获取到的图片\r\n\r\n      const res = await updateUserPhotoAPI(theFd);\r\n      // console.log(res);\r\n      this.profileObj.photo = res.data.data.photo;\r\n    },\r\n    // 修改头像\r\n    imageClickFn() {\r\n      // 模拟标签的点击事件\r\n      this.$refs.iptFile.click();\r\n    },\r\n    // 修改名称\r\n    nameClickFn() {\r\n      this.show = true;\r\n      this.inputUserName = this.profileObj.name;\r\n    },\r\n    // 关闭弹框前的操作\r\n    async beforeCloseFn(action, done) {\r\n      if (action === \"confirm\") {\r\n        // 点了确定\r\n        const reg = /^[a-zA-Z0-9\\u4e00-\\u9fa5]{1,7}$/;\r\n        if (reg.test(this.inputUserName) === true) {\r\n          // 通过校验\r\n          await updateUserProfileAPI({\r\n            name: this.inputUserName\r\n          });\r\n          this.profileObj.name = this.inputUserName; //更新成功--数据回显页面上\r\n          done();\r\n        } else {\r\n          // 没通过校验\r\n          Notify({ type: \"warning\", message: \"请输入1-7位的中英数字\" });\r\n          done(false);\r\n        }\r\n      } else {\r\n        // 点取消\r\n        done(); //让弹窗关闭\r\n      }\r\n    },\r\n    // 显示用户生日-生日单元格\r\n    birthdayClickFn() {\r\n      this.dateTimePickerShow = true;\r\n      this.currentDate = new Date(this.profileObj.birthday);\r\n    },\r\n    // 日期选择器-取消事件\r\n    dateCancelFn() {\r\n      this.dateTimePickerShow = false;\r\n    },\r\n    async confirmFn() {\r\n      // 日期选择器组件里是日期对象，而后台要的是年-月-日字符串\r\n      await updateUserProfileAPI({\r\n        birthday: formateDate(this.currentDate)\r\n      });\r\n      this.dateTimePickerShow = false;\r\n      this.profileObj.birthday = formateDate(this.currentDate); //数据回显到页面\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.user-edit-container {\r\n  padding-top: 46px;\r\n  .avatar {\r\n    width: 50px;\r\n    height: 50px;\r\n  }\r\n}\r\n/deep/ .van-dialog__content {\r\n  text-align: center;\r\n  input {\r\n    padding: 0;\r\n    border: none;\r\n    outline: none;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>"]}]}
{"remainingRequest":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\Chat\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\Chat\\index.vue","mtime":1678170280537},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\babel.config.js","mtime":1664795892678},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucHVzaC5qcyI7CmltcG9ydCB7IGlvIH0gZnJvbSAic29ja2V0LmlvLWNsaWVudCI7CmltcG9ydCB7IGdldFRva2VuIH0gZnJvbSAiQC91dGlscy90b2tlbi5qcyI7CmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiQ2hhdCIsCgogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICB3b3JkOiAiIiwKICAgICAgLy/ovpPlhaXmoYbnmoTlhoXlrrkKICAgICAgbGlzdDogWy8vIOagueaNrm5hbWXlsZ7mgKfvvIzliKTmlq3mtojmga/lupTor6XmuLLmn5PlnKjlk6rkuKpkaXYKICAgICAgewogICAgICAgIG5hbWU6ICJ4cyIsCiAgICAgICAgbXNnOiAiaGks5L2g5aW977yB5oiR5piv5bCP5oCdIgogICAgICB9LCB7CiAgICAgICAgbmFtZTogIm1lIiwKICAgICAgICBtc2c6ICLmiJHmmK/nvJbnqIvlsI/njovlrZAiCiAgICAgIH1dLAogICAgICBzb2NrZXQ6IG51bGwgLy/lrqLmiLfnq6/lkozmnI3liqHlmajnq6/lu7rnq4vov57mjqXnmoRzb2NrZXTlr7nosaEKCiAgICB9OwogIH0sCgogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLnNvY2tldCA9IGlvKCJodHRwOi8vdG91dGlhby5pdGhlaW1hLm5ldCIsIHsKICAgICAgcXVlcnk6IHsKICAgICAgICB0b2tlbjogZ2V0VG9rZW4oKQogICAgICB9LAogICAgICB0cmFuc3BvcnRzOiBbIndlYnNvY2tldCJdCiAgICB9KTsgLy8g5rWL6K+V6L+e5o6l5piv5ZCm5bu656uL5oiQ5YqfCgogICAgdGhpcy5zb2NrZXQub24oImNvbm5lY3QiLCAoKSA9PiB7CiAgICAgIGNvbnNvbGUubG9nKCLov57mjqXmiJDlip8iKTsKICAgIH0pOyAvLyDmjqXmlLbmnI3liqHlmajkvKDlm57mnaXnmoTmtojmga8KCiAgICB0aGlzLnNvY2tldC5vbigibWVzc2FnZSIsIG9iaiA9PiB7CiAgICAgIC8vIGNvbnNvbGUubG9nKG9iaik7CiAgICAgIC8vIOeri+WIu+mYu+atouebuOWQjOWtl+auteWvueixoeaUvuWIsOaVsOe7hOmHjC0t44CLdi1mb3Lmm7TmlrAKICAgICAgdGhpcy5saXN0LnB1c2goewogICAgICAgIG5hbWU6ICJ4cyIsCiAgICAgICAgbXNnOiBvYmoubXNnCiAgICAgIH0pOyAvLyDmnIDlkI7kuIDmnaHogYrlpKnmtojmga/mu5rliqjliLDlsY/luZXojIPlm7QKICAgICAgLy8g5pWw5o2u5Y+Y5YyWLeOAi0RPTeabtOaWsOaYr+W8guatpeeahO+8jOaJgOS7peiOt+WPlueahOaYr+S4iuS4gOadoQoKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIGNvbnN0IHRoZURpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWxpc3Q+ZGl2Omxhc3QtY2hpbGQiKTsKICAgICAgICB0aGVEaXYuc2Nyb2xsSW50b1ZpZXcoewogICAgICAgICAgYmVoYXZpb3I6ICJzbW9vdGgiCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKCiAgbWV0aG9kczogewogICAgLy8g5Y+R6YCB5raI5oGvLeeCueWHu+S6i+S7tgogICAgc2VuZEZuKCkgewogICAgICBpZiAodGhpcy53b3JkLnRyaW0oKS5sZW5ndGggPT09IDApIHJldHVybjsgLy8gc29ja2V06ZO+5o6l5a+56LGhLmVtaXQoJ+WQjuerr+aOpeaUtua2iOaBr+eahOS6i+S7tuWQjSfvvIwg5YC8KQoKICAgICAgdGhpcy5zb2NrZXQuZW1pdCgibWVzc2FnZSIsIHsKICAgICAgICBtc2c6IHRoaXMud29yZCwKICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkuZ2V0VGltZSgpCiAgICAgIH0pOyAvLyDmiormtojmga/mmL7npLrliLDlr7nor53moYYKCiAgICAgIHRoaXMubGlzdC5wdXNoKHsKICAgICAgICBtc2c6IHRoaXMud29yZCwKICAgICAgICBuYW1lOiAibWUiCiAgICAgIH0pOyAvLyDmnIDlkI7kuIDmnaHogYrlpKnmtojmga/mu5rliqjliLDlsY/luZXojIPlm7QKICAgICAgLy8g5pWw5o2u5Y+Y5YyWLeOAi0RPTeabtOaWsOaYr+W8guatpeeahO+8jOaJgOS7peiOt+WPlueahOaYr+S4iuS4gOadoQoKICAgICAgdGhpcy4kbmV4dFRpY2soKCkgPT4gewogICAgICAgIGNvbnN0IHRoZURpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWxpc3Q+ZGl2Omxhc3QtY2hpbGQiKTsKICAgICAgICB0aGVEaXYuc2Nyb2xsSW50b1ZpZXcoewogICAgICAgICAgYmVoYXZpb3I6ICJzbW9vdGgiCiAgICAgICAgfSk7CiAgICAgIH0pOyAvLyDmuIXnqbrovpPlhaXmoYYKCiAgICAgIHRoaXMud29yZCA9ICIiOyAvLyBjb25zb2xlLmxvZygiMTExIik7CiAgICB9CgogIH0sCgogIGRlc3Ryb3llZCgpIHsKICAgIHRoaXMuc29ja2V0LmNsb3NlKCk7CiAgICB0aGlzLnNvY2tldCA9IG51bGw7CiAgfQoKfTs="},{"version":3,"mappings":";AAiCA;AACA;AACA;EACAA,YADA;;EAEAC;IACA;MACAC,QADA;MACA;MACAC,OACA;MACA;QAAAH;QAAAI;MAAA,CAFA,EAGA;QAAAJ;QAAAI;MAAA,CAHA,CAFA;MAOAC,YAPA,CAOA;;IAPA;EASA,CAZA;;EAaAC;IACA;MACAC;QACAC;MADA,CADA;MAIAC;IAJA,GADA,CAQA;;IACA;MACAC;IACA,CAFA,EATA,CAYA;;IACA;MACA;MACA;MACA;QACAV,UADA;QAEAI;MAFA,GAHA,CAQA;MACA;;MACA;QACA;QACAO;UACAC;QADA;MAGA,CALA;IAMA,CAhBA;EAiBA,CA3CA;;EA4CAC;IACA;IACAC;MACA,0CADA,CAEA;;MACA;QACAV,cADA;QAEAW;MAFA,GAHA,CAOA;;MACA;QACAX,cADA;QAEAJ;MAFA,GARA,CAaA;MACA;;MACA;QACA;QACAW;UACAC;QADA;MAGA,CALA,EAfA,CAsBA;;MACA,eAvBA,CAwBA;IACA;;EA3BA,CA5CA;;EAyEAI;IACA;IACA;EACA;;AA5EA","names":["name","data","word","list","msg","socket","created","query","token","transports","console","theDiv","behavior","methods","sendFn","timestamp","destroyed"],"sourceRoot":"src/views/Chat","sources":["index.vue"],"sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!-- 固定导航 -->\r\n    <van-nav-bar fixed left-arrow @click-left=\"$router.back()\" title=\"小思同学\" class=\"xiaosi\"></van-nav-bar>\r\n    <!-- 聊天主体区域 -->\r\n    <div class=\"chat-list\">\r\n      <div v-for=\"(obj,index) in list\" :key=\"index\">\r\n        <!-- 左侧-机器人小思 -->\r\n        <div class=\"chat-item left\" v-if=\"obj.name !== 'me'\">\r\n          <van-image fit=\"cover\" round src=\"https://img.yzcdn.cn/vant/cat.jpeg\"></van-image>\r\n          <div class=\"chat-pao\">{{obj.msg}}</div>\r\n        </div>\r\n\r\n        <!-- 右侧-当前用户 -->\r\n        <div class=\"chat-item right\" v-else>\r\n          <div class=\"chat-pao\">{{obj.msg}}</div>\r\n          <van-image fit=\"cover\" round :src=\"$store.state.userPhoto\"></van-image>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 对话区域 -->\r\n    <div class=\"reply-container van-hairline--top\">\r\n      <van-field placeholder=\"说点什么...\" v-model=\"word\">\r\n        <template #button>\r\n          <span style=\"font-size:18px;color:#999\" @click=\"sendFn\">提交</span>\r\n        </template>\r\n      </van-field>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { io } from \"socket.io-client\";\r\nimport { getToken } from \"@/utils/token.js\";\r\nexport default {\r\n  name: \"Chat\",\r\n  data() {\r\n    return {\r\n      word: \"\", //输入框的内容\r\n      list: [\r\n        // 根据name属性，判断消息应该渲染在哪个div\r\n        { name: \"xs\", msg: \"hi,你好！我是小思\" },\r\n        { name: \"me\", msg: \"我是编程小王子\" }\r\n      ],\r\n      socket: null //客户端和服务器端建立连接的socket对象\r\n    };\r\n  },\r\n  created() {\r\n    this.socket = io(\"http://toutiao.itheima.net\", {\r\n      query: {\r\n        token: getToken()\r\n      },\r\n      transports: [\"websocket\"]\r\n    });\r\n\r\n    // 测试连接是否建立成功\r\n    this.socket.on(\"connect\", () => {\r\n      console.log(\"连接成功\");\r\n    });\r\n    // 接收服务器传回来的消息\r\n    this.socket.on(\"message\", obj => {\r\n      // console.log(obj);\r\n      // 立刻阻止相同字段对象放到数组里--》v-for更新\r\n      this.list.push({\r\n        name: \"xs\",\r\n        msg: obj.msg\r\n      });\r\n\r\n      // 最后一条聊天消息滚动到屏幕范围\r\n      // 数据变化-》DOM更新是异步的，所以获取的是上一条\r\n      this.$nextTick(() => {\r\n        const theDiv = document.querySelector(\".chat-list>div:last-child\");\r\n        theDiv.scrollIntoView({\r\n          behavior: \"smooth\"\r\n        });\r\n      });\r\n    });\r\n  },\r\n  methods: {\r\n    // 发送消息-点击事件\r\n    sendFn() {\r\n      if (this.word.trim().length === 0) return;\r\n      // socket链接对象.emit('后端接收消息的事件名'， 值)\r\n      this.socket.emit(\"message\", {\r\n        msg: this.word,\r\n        timestamp: new Date().getTime()\r\n      });\r\n      // 把消息显示到对话框\r\n      this.list.push({\r\n        msg: this.word,\r\n        name: \"me\"\r\n      });\r\n\r\n      // 最后一条聊天消息滚动到屏幕范围\r\n      // 数据变化-》DOM更新是异步的，所以获取的是上一条\r\n      this.$nextTick(() => {\r\n        const theDiv = document.querySelector(\".chat-list>div:last-child\");\r\n        theDiv.scrollIntoView({\r\n          behavior: \"smooth\"\r\n        });\r\n      });\r\n\r\n      // 清空输入框\r\n      this.word = \"\";\r\n      // console.log(\"111\");\r\n    }\r\n  },\r\n  destroyed() {\r\n    this.socket.close();\r\n    this.socket = null;\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.container {\r\n  height: 100%;\r\n  width: 100%;\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  box-sizing: border-box;\r\n  background: #fafafa;\r\n  padding: 46px 0 50px 0;\r\n  // /deep/ .van-nav-bar__content {\r\n  //   margin-bottom: 15px;\r\n  // }\r\n  .chat-list {\r\n    height: 100%;\r\n    overflow-y: scroll;\r\n    padding-top: 35px;\r\n    padding-bottom: 65px;\r\n    .chat-item {\r\n      padding: 10px;\r\n      /deep/ .van-image__img {\r\n        vertical-align: top;\r\n        width: 60px;\r\n        height: 60px;\r\n      }\r\n      .chat-pao {\r\n        vertical-align: top;\r\n        display: inline-block;\r\n        margin-top: 10px !important;\r\n        min-width: 40px;\r\n        max-width: 70%;\r\n        min-height: 40px;\r\n        line-height: 45px;\r\n        border: 0.5px solid #c2d9ea;\r\n        border-radius: 4px;\r\n        position: relative;\r\n        padding: 0 10px;\r\n        background-color: #e0effb;\r\n        word-break: break-all;\r\n        font-size: 14px;\r\n        color: #333;\r\n        &::before {\r\n          content: \"\";\r\n          width: 10px;\r\n          height: 10px;\r\n          position: absolute;\r\n          top: 12px;\r\n          border-top: 0.5px solid #c2d9ea;\r\n          border-right: 0.5px solid #c2d9ea;\r\n          background: #e0effb;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n.right {\r\n  text-align: right;\r\n  .chat-pao {\r\n    margin-left: 0;\r\n    margin-right: 15px;\r\n    &::before {\r\n      right: -6px;\r\n      transform: rotate(45deg);\r\n    }\r\n  }\r\n}\r\n.left {\r\n  text-align: left;\r\n  .chat-pao {\r\n    margin-left: 15px;\r\n    margin-right: 0;\r\n    &::before {\r\n      left: -5px;\r\n      transform: rotate(-135deg);\r\n    }\r\n  }\r\n}\r\n.reply-container {\r\n  position: fixed;\r\n  left: 0;\r\n  bottom: 0;\r\n  // padding: 0 10px 0 10px;\r\n  // height: 20% !important;\r\n  text-align: center;\r\n  width: 100%;\r\n  background: #f5f5f5;\r\n  z-index: 9999;\r\n}\r\n</style>"]}]}
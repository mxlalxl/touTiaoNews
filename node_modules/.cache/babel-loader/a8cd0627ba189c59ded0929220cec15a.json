{"remainingRequest":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js!D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\Home\\components\\ArticleList.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\Home\\components\\ArticleList.vue","mtime":1666422641259},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\babel.config.js","mtime":1664795892678},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJ2YW50L2VzL25vdGlmeS9zdHlsZS9sZXNzIjsKaW1wb3J0IF9Ob3RpZnkgZnJvbSAidmFudC9lcy9ub3RpZnkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5wdXNoLmpzIjsKaW1wb3J0IEFydGljbGVJdGVtIGZyb20gIkAvY29tcG9uZW50cy9BcnRpY2xlSXRlbS52dWUiOwppbXBvcnQgeyBnZXRBbGxBcnRpY2xlQVBJLCBkaXNsaWtlQXJ0aWNsZUFQSSwgcmVwb3J0QXJ0aWNsZUFQSSB9IGZyb20gIkAvYXBpIjsKZXhwb3J0IGRlZmF1bHQgewogIGNvbXBvbmVudHM6IHsKICAgIEFydGljbGVJdGVtCiAgfSwKICBwcm9wczogewogICAgLy8gbGlzdDogQXJyYXkKICAgIGNoYW5uZWxJZDogTnVtYmVyCiAgfSwKCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGxpc3Q6IFtdLAogICAgICAvL+aWh+eroOWIl+ihqOaVsOe7hAogICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgZmluaXNoZWQ6IGZhbHNlLAogICAgICB0aGVUaW1lOiBuZXcgRGF0ZSgpLmdldFRpbWUoKSwKICAgICAgaXNMb2FkaW5nOiBmYWxzZQogICAgfTsKICB9LAoKICBhc3luYyBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRBcnRpY2xlTGlzdEZuKCk7CiAgfSwKCiAgbWV0aG9kczogewogICAgLy8g5LiK5ouJ5Yqg6L295pu05aSaCiAgICBhc3luYyBvbkxvYWQoKSB7CiAgICAgIHRoaXMuZ2V0QXJ0aWNsZUxpc3RGbigpOwogICAgfSwKCiAgICBhc3luYyBnZXRBcnRpY2xlTGlzdEZuKCkgewogICAgICBjb25zdCByZXMgPSBhd2FpdCBnZXRBbGxBcnRpY2xlQVBJKHsKICAgICAgICBjaGFubmVsX2lkOiB0aGlzLmNoYW5uZWxJZCwKICAgICAgICB0aW1lc3RhbXA6IHRoaXMudGhlVGltZQogICAgICB9KTsKICAgICAgdGhpcy5saXN0ID0gWy4uLnRoaXMubGlzdCwgLi4ucmVzLmRhdGEuZGF0YS5yZXN1bHRzXTsKICAgICAgdGhpcy50aGVUaW1lID0gcmVzLmRhdGEuZGF0YS5wcmVfdGltZXN0YW1wOwogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZTsgLy/lpoLmnpzkuI3lhbPvvIzlupXpg6jkuIDnm7TmmK/liqDovb3nirbmgIHvvIzkuI3kvJrlho3op6blj5FvbmxvYWTkuovku7YKCiAgICAgIGlmIChyZXMuZGF0YS5kYXRhLnByZV90aW1lc3RhbXAgPT09IG51bGwpIHsKICAgICAgICAvL+acrOasoeivt+axgueahOacgOWQjuS4gOmhteaVsOaNru+8jOayoeacieabtOWkmuaVsOaNruS6hgogICAgICAgIHRoaXMuZmluaXNoZWQgPSB0cnVlOwogICAgICAgIHJldHVybjsKICAgICAgfSAvLyDpobbpg6jliqDovb3nirbmgIHmlLnkuLpmYWxzZQoKCiAgICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7CiAgICB9LAoKICAgIC8vIOS4i+aLieWIt+aWsAogICAgYXN5bmMgb25SZWZyZXNoKCkgewogICAgICB0aGlzLmxpc3QgPSBbXTsKICAgICAgdGhpcy50aGVUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7CiAgICAgIHRoaXMuZ2V0QXJ0aWNsZUxpc3RGbigpOwogICAgfSwKCiAgICAvLyDlj43ppogt5LiN5oSf5YW06LajCiAgICBhc3luYyBkaXNsaWtlRm4oaWQpIHsKICAgICAgLy8gdHJ5K2NhdGNo5o2V6I635ZCM5q2l5Luj56CB55qE5byC5bi4CiAgICAgIHRyeSB7CiAgICAgICAgYXdhaXQgZGlzbGlrZUFydGljbGVBUEkoewogICAgICAgICAgYXJ0SWQ6IGlkCiAgICAgICAgfSk7IC8vIGNvbnNvbGUubG9nKGlkKTsKICAgICAgICAvLyBjb25zb2xlLmxvZyhyZXMpOwoKICAgICAgICBfTm90aWZ5KHsKICAgICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICAgIG1lc3NhZ2U6ICLlj43ppojmiJDlip8iCiAgICAgICAgfSk7CgogICAgICAgIGNvbnNvbGUubG9nKCLmiJDlip/kuoYiKTsKICAgICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgICBjb25zb2xlLmxvZygi5aSx6LSl5LqGIik7CiAgICAgIH0KICAgIH0sCgogICAgLy8g5Y+N6aaILeS4vuaKpeaWh+eroAogICAgYXN5bmMgcmVwb3J0Rm4oaWQsIHZhbHVlKSB7CiAgICAgIGF3YWl0IHJlcG9ydEFydGljbGVBUEkoewogICAgICAgIGFydElkOiBpZCwKICAgICAgICB0eXBlOiB2YWx1ZQogICAgICB9KTsKCiAgICAgIF9Ob3RpZnkoewogICAgICAgIHR5cGU6ICJzdWNjZXNzIiwKICAgICAgICBtZXNzYWdlOiAi5Li+5oql5oiQ5YqfIgogICAgICB9KTsKICAgIH0sCgogICAgLy8g5paH56ugLeeCueWHu+S6i+S7ti3ot7PovazliLDmlofnq6Dor6bmg4UKICAgIGl0ZW1DbGlja0ZuKGlkKSB7CiAgICAgIC8vIGNvbnNvbGUubG9nKCIxMjMiKTsKICAgICAgdGhpcy4kcm91dGVyLnB1c2goewogICAgICAgIHBhdGg6IGAvZGV0YWlsP2FydF9pZD0ke2lkfWAKICAgICAgfSk7CiAgICB9CgogIH0KfTs="},{"version":3,"mappings":";;;AA6BA;AACA;AAGA;EACAA;IACAC;EADA,CADA;EAIAC;IACA;IACAC;EAFA,CAJA;;EAQAC;IACA;MACAC,QADA;MACA;MACAC,cAFA;MAGAC,eAHA;MAIAC,6BAJA;MAKAC;IALA;EAOA,CAhBA;;EAiBA;IACA;EACA,CAnBA;;EAoBAC;IACA;IACA;MACA;IACA,CAJA;;IAKA;MACA;QACAC,0BADA;QAEAC;MAFA;MAKA;MACA;MACA,qBARA,CAQA;;MAEA;QACA;QACA;QACA;MACA,CAdA,CAgBA;;;MACA;IACA,CAvBA;;IAyBA;IACA;MACA;MACA;MAEA;IACA,CA/BA;;IAiCA;IACA;MACA;MACA;QACA;UACAC;QADA,GADA,CAIA;QAEA;;QACA;UAAAC;UAAAC;QAAA;;QACAC;MACA,CATA,CASA;QACAA;MACA;IACA,CAhDA;;IAkDA;IACA;MACA;QACAH,SADA;QAEAC;MAFA;;MAIA;QAAAA;QAAAC;MAAA;IACA,CAzDA;;IA0DA;IACAE;MACA;MACA;QACAC;MADA;IAGA;;EAhEA;AApBA","names":["components","ArticleItem","props","channelId","data","list","loading","finished","theTime","isLoading","methods","channel_id","timestamp","artId","type","message","console","itemClickFn","path"],"sourceRoot":"src/views/Home/components","sources":["ArticleList.vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- 问题1：网页刚打开，created和onload里面的请求同时发送，请求的都是最新数据 -->\r\n    <!-- 在onload中，两次一样的数据合并，数据重复，key重复了 -->\r\n    <!-- 原因：van-list组件，组件挂载时，默认就会判断一次是触底 -->\r\n    <!-- 解决办法1:list组件添加：:immediate-check=\"false\" 上来初始化时不用判定 -->\r\n    <!-- 2：在onload第一行加一个list数组长度判断 -->\r\n    <van-pull-refresh v-model=\"isLoading\" @refresh=\"onRefresh\">\r\n      <van-list\r\n        v-model=\"loading\"\r\n        :finished=\"finished\"\r\n        finished-text=\"没有更多了\"\r\n        @load=\"onLoad\"\r\n        :immediate-check=\"false\"\r\n        offset=\"50\"\r\n      >\r\n        <ArticleItem\r\n          v-for=\"obj in list\"\r\n          :key=\"obj.art_id\"\r\n          :artObj=\"obj\"\r\n          @dislikeEV=\"dislikeFn\"\r\n          @reportEV=\"reportFn\"\r\n          @click.native=\"itemClickFn(obj.art_id)\"\r\n        ></ArticleItem>\r\n      </van-list>\r\n    </van-pull-refresh>\r\n  </div>\r\n</template>\r\n<script>\r\nimport ArticleItem from \"@/components/ArticleItem.vue\";\r\nimport { getAllArticleAPI, dislikeArticleAPI, reportArticleAPI } from \"@/api\";\r\nimport { Notify } from \"vant\";\r\n\r\nexport default {\r\n  components: {\r\n    ArticleItem\r\n  },\r\n  props: {\r\n    // list: Array\r\n    channelId: Number\r\n  },\r\n  data() {\r\n    return {\r\n      list: [], //文章列表数组\r\n      loading: false,\r\n      finished: false,\r\n      theTime: new Date().getTime(),\r\n      isLoading: false\r\n    };\r\n  },\r\n  async created() {\r\n    this.getArticleListFn();\r\n  },\r\n  methods: {\r\n    // 上拉加载更多\r\n    async onLoad() {\r\n      this.getArticleListFn();\r\n    },\r\n    async getArticleListFn() {\r\n      const res = await getAllArticleAPI({\r\n        channel_id: this.channelId,\r\n        timestamp: this.theTime\r\n      });\r\n\r\n      this.list = [...this.list, ...res.data.data.results];\r\n      this.theTime = res.data.data.pre_timestamp;\r\n      this.loading = false; //如果不关，底部一直是加载状态，不会再触发onload事件\r\n\r\n      if (res.data.data.pre_timestamp === null) {\r\n        //本次请求的最后一页数据，没有更多数据了\r\n        this.finished = true;\r\n        return;\r\n      }\r\n\r\n      // 顶部加载状态改为false\r\n      this.isLoading = false;\r\n    },\r\n\r\n    // 下拉刷新\r\n    async onRefresh() {\r\n      this.list = [];\r\n      this.theTime = new Date().getTime();\r\n\r\n      this.getArticleListFn();\r\n    },\r\n\r\n    // 反馈-不感兴趣\r\n    async dislikeFn(id) {\r\n      // try+catch捕获同步代码的异常\r\n      try {\r\n        await dislikeArticleAPI({\r\n          artId: id\r\n        });\r\n        // console.log(id);\r\n\r\n        // console.log(res);\r\n        Notify({ type: \"success\", message: \"反馈成功\" });\r\n        console.log(\"成功了\");\r\n      } catch (error) {\r\n        console.log(\"失败了\");\r\n      }\r\n    },\r\n\r\n    // 反馈-举报文章\r\n    async reportFn(id, value) {\r\n      await reportArticleAPI({\r\n        artId: id,\r\n        type: value\r\n      });\r\n      Notify({ type: \"success\", message: \"举报成功\" });\r\n    },\r\n    // 文章-点击事件-跳转到文章详情\r\n    itemClickFn(id) {\r\n      // console.log(\"123\");\r\n      this.$router.push({\r\n        path: `/detail?art_id=${id}`\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"\">\r\n</style>"]}]}
{"remainingRequest":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\ArticleDetail\\CommentList.vue?vue&type=style&index=0&id=30bff1ea&lang=less&scoped=true&","dependencies":[{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\ArticleDetail\\CommentList.vue","mtime":1666579629485},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\css-loader\\dist\\cjs.js","mtime":1664795354518},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1664795355419},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\postcss-loader\\src\\index.js","mtime":1614782079830},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\less-loader\\dist\\cjs.js","mtime":1664094124859},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouY210LWxpc3Qgew0KICBwYWRkaW5nOiAxMHB4Ow0KICAuY210LWl0ZW0gew0KICAgIHBhZGRpbmc6IDE1cHggMDsNCiAgICAuY210LWl0ZW0gew0KICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNmOGY4Zjg7DQogICAgfQ0KICAgIC5jbXQtaGVhZGVyIHsNCiAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgLmNtdC1oZWFkZXItbGVmdCB7DQogICAgICAgIGRpc3BsYXk6IGZsZXg7DQogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgIC5hdmF0YXIgew0KICAgICAgICAgIHdpZHRoOiA0MHB4Ow0KICAgICAgICAgIGhlaWdodDogNDBweDsNCiAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjhmOGY4Ow0KICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDE1cHg7DQogICAgICAgIH0NCiAgICAgICAgLnVuYW1lIHsNCiAgICAgICAgICBmb250LXNpemU6IDEycHg7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9DQogICAgLmNtdC1ib2R5IHsNCiAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgIGxpbmUtaGVpZ2h0OiAyOHB4Ow0KICAgICAgdGV4dC1pbmRlbnQ6IDJlbTsNCiAgICAgIG1hcmdpbi10b3A6IDZweDsNCiAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbDsNCiAgICB9DQogICAgLmNtdC1mb290ZXIgew0KICAgICAgZm9udC1zaXplOiAxMnB4Ow0KICAgICAgY29sb3I6IGdyYXk7DQogICAgICBtYXJnaW4tdG9wOiAxMHB4Ow0KICAgIH0NCiAgfQ0KfQ0KDQovLyDor4TorrrljLrln5/moLflvI8NCi5hcnQtY210LWNvbnRhaW5lci0xIHsNCiAgcGFkZGluZy1ib3R0b206IDc2cHg7DQp9DQouYXJ0LWNtdC1jb250YWluZXItMiB7DQogIHBhZGRpbmctYm90dG9tOiA4MHB4Ow0KfQ0KDQovLyDlj5HluIPor4Torrrnm5LlrZAtLTENCi5hZGQtY210LWJveCB7DQogIHBvc2l0aW9uOiBmaXhlZDsNCiAgYm90dG9tOiAwOw0KICBsZWZ0OiAwOw0KICB3aWR0aDogMTAwJTsNCiAgYm94LXNpemluZzogYm9yZGVyLWJveDsNCiAgYmFja2dyb3VuZC1jb2xvcjogd2hpdGU7DQogIGRpc3BsYXk6IGZsZXg7DQogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgaGVpZ2h0OiA3NnB4Ow0KICBsaW5lLWhlaWdodDogNDZweDsNCiAgcGFkZGluZy1sZWZ0OiAxMHB4Ow0KICAuaXB0LWNtdC1kaXYgew0KICAgIGZsZXg6IDE7DQogICAgYm9yZGVyOiAxcHggc29saWQgI2VmZWZlZjsNCiAgICBib3JkZXItcmFkaXVzOiAxNXB4Ow0KICAgIGhlaWdodDogMzBweDsNCiAgICBmb250LXNpemU6IDEycHg7DQogICAgbGluZS1oZWlnaHQ6IDMwcHg7DQogICAgcGFkZGluZy1sZWZ0OiAxNXB4Ow0KICAgIG1hcmdpbi1sZWZ0OiAxMHB4Ow0KICAgIGJhY2tncm91bmQtY29sb3I6ICNmOGY4Zjg7DQogIH0NCiAgLmljb24tYm94IHsNCiAgICB3aWR0aDogNTAlOw0KICAgIGRpc3BsYXk6IGZsZXg7DQogICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1ldmVubHk7DQogICAgbGluZS1oZWlnaHQ6IDA7DQogIH0NCn0NCi5jaGlsZCB7DQogIHdpZHRoOiAyMHB4Ow0KICBoZWlnaHQ6IDIwcHg7DQogIGJhY2tncm91bmQ6ICNmMmYzZjU7DQp9DQoNCi8vIOWPkeihqOivhOiuuueahOebkuWtkC0tLTINCi5jbXQtYm94IHsNCiAgcG9zaXRpb246IGZpeGVkOw0KICBib3R0b206IDA7DQogIGxlZnQ6IDA7DQogIHdpZHRoOiAxMDAlOw0KICBoZWlnaHQ6IDgwcHg7DQogIGRpc3BsYXk6IGZsZXg7DQogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgZm9udC1zaXplOiAxMnB4Ow0KICBwYWRkaW5nLWxlZnQ6IDEwcHg7DQogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOw0KICB0ZXh0YXJlYSB7DQogICAgZmxleDogMTsNCiAgICBoZWlnaHQ6IDY2JTsNCiAgICBib3JkZXI6IDFweCBzb2xpZCAjZWZlZmVmOw0KICAgIGJhY2tncm91bmQtY29sb3I6ICNmOGY4Zjg7DQogICAgcmVzaXplOiBub25lOw0KICAgIGJvcmRlci1yYWRpdXM6IDZweDsNCiAgICBwYWRkaW5nOiA1cHg7DQogIH0NCiAgLnZhbi1idXR0b24gew0KICAgIGhlaWdodDogMTAwJTsNCiAgICBib3JkZXI6IG5vbmU7DQogIH0NCn0NCg=="},{"version":3,"sources":["CommentList.vue"],"names":[],"mappings":";AAgLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"CommentList.vue","sourceRoot":"src/views/ArticleDetail","sourcesContent":["<template>\r\n  <div>\r\n    <!-- 评论列表 -->\r\n    <div\r\n      class=\"cmt-list\"\r\n      :class=\"{'art-cmt-container-1': isShowCmtBox, 'art-cmt-container-2': !isShowCmtBox}\"\r\n    >\r\n      <van-list\r\n        v-model=\"loading\"\r\n        :finished=\"finished\"\r\n        finished-text=\"没有更多了\"\r\n        @load=\"onLoad\"\r\n        :immediate-check=\"false\"\r\n      >\r\n        <!-- 评论的item项 -->\r\n        <div class=\"cmt-item\" v-for=\"obj in commentArr\" :key=\"obj.com_id\">\r\n          <!-- 头部区域 -->\r\n          <div class=\"cmt-header\">\r\n            <!-- 头部左侧 -->\r\n            <div class=\"cmt-header-left\">\r\n              <img :src=\"obj.aut_photo\" alt class=\"avatar\" />\r\n              <span class=\"uname\">{{obj.aut_name}}</span>\r\n            </div>\r\n            <!-- 头部右侧 -->\r\n            <div class=\"cmt-header-right\">\r\n              <van-icon\r\n                name=\"like\"\r\n                size=\"16\"\r\n                color=\"red\"\r\n                v-if=\"obj.is_liking === true\"\r\n                @click=\"likeFn(true, obj)\"\r\n              ></van-icon>\r\n              <van-icon name=\"like-o\" size=\"16\" color=\"gray\" v-else @click=\"likeFn(false)\"></van-icon>\r\n            </div>\r\n          </div>\r\n          <!-- 主体区域 -->\r\n          <div class=\"cmt-body\">{{obj.content}}</div>\r\n          <!-- 尾部区域 -->\r\n          <div class=\"cmt-footer\">{{timeAgo(obj.pubdate)}}</div>\r\n        </div>\r\n      </van-list>\r\n    </div>\r\n\r\n    <!-- 发表评论容器 -->\r\n    <div>\r\n      <!-- 底部评论区域--短 --1 -->\r\n      <div class=\"add-cmt-box van-hairline--top\" v-if=\"isShowCmtBox === true\">\r\n        <van-icon name=\"arrow-left\" size=\"0.48rem\" @click=\"$router.back()\"></van-icon>\r\n        <div class=\"ipt-cmt-div\" @click=\"toggleShowFn\">发表评论</div>\r\n        <div class=\"icon-box\">\r\n          <van-badge :content=\"totalCount === 0? '':totalCount\" max=\"99\">\r\n            <van-icon name=\"comment-o\" size=\"0.533333334rem\" @click=\"commentClickFn\"></van-icon>\r\n          </van-badge>\r\n          <van-icon name=\"star-o\" size=\"0.533333334rem\"></van-icon>\r\n          <van-icon name=\"share-o\" size=\"0.533333334rem\"></van-icon>\r\n        </div>\r\n      </div>\r\n      <!-- 底部评论区域--长 -->\r\n      <div class=\"cmt-box van-hairline--top\" v-else>\r\n        <textarea placeholder=\"友善评论、理性发言、阳光心灵\" v-fofo @blur=\"blurFn\" v-model=\"comText\"></textarea>\r\n        <van-button type=\"default\" :disabled=\"comText.length === 0\" @click=\"sendFn\">发布</van-button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  commentsListAPI,\r\n  commentDisLikingAPI,\r\n  commentLikingAPI,\r\n  commentSendAPI\r\n} from \"@/api\";\r\nimport { timeAgo } from \"@/utils/dayjs.js\";\r\nexport default {\r\n  data() {\r\n    return {\r\n      offset: null,\r\n      commentArr: [],\r\n      isShowCmtBox: true,\r\n      totalCount: 0, //评论条数\r\n      comText: \"\",\r\n      loading: false,\r\n      finished: false,\r\n      lastId: \"\"\r\n    };\r\n  },\r\n  async created() {\r\n    const res = await commentsListAPI({\r\n      id: this.$route.query.art_id\r\n    });\r\n    // console.log(res);\r\n    this.commentArr = res.data.data.results;\r\n    this.totalCount = res.data.data.total_count;\r\n    this.lastId = res.data.data.last_id; //用于分页\r\n\r\n    // 网页打开--没有评论，让其显示没有更多了\r\n    if (res.data.data.results.length === 0) {\r\n      this.finished = true;\r\n    }\r\n  },\r\n  methods: {\r\n    timeAgo,\r\n    async likeFn(bool, commentObj) {\r\n      if (bool === true) {\r\n        // 用户点在红心，取消点赞\r\n        commentObj.is_liking = false;\r\n        await commentDisLikingAPI({\r\n          comId: commentObj.com_id\r\n        });\r\n      } else {\r\n        //   用户点在了灰心上--点赞\r\n        commentObj.is_liking = true;\r\n        await commentLikingAPI({\r\n          comId: commentObj.com_id\r\n        });\r\n      }\r\n    },\r\n    toggleShowFn() {\r\n      this.isShowCmtBox = false;\r\n    },\r\n    // 评论滚动到顶部\r\n    commentClickFn() {\r\n      // js做动画：计时器间隔时间，修改目标状态。动画实现的JS原生代码，在配置资料txt文件\r\n      // 比较方便的动画：原生标签.scrollIntoView(),让原生的标签滚到屏幕的最上面\r\n      // 为何选择like-box，不选第一条评论，因为会被头部导航挡住\r\n      document.querySelector(\".like-box\").scrollIntoView({\r\n        behavior: \"smooth\"\r\n      });\r\n    },\r\n    // 输入框--失去焦点\r\n    blurFn() {\r\n      //问题：点击发布按钮，发现点击事件不执行\r\n      // 原因：高的评论容器-在点击发布的一瞬间，输入框失去了焦点，被v-if和v-else移除了整个标签\r\n      // 解决：失去焦点时，变量值，在最后执行\r\n      setTimeout(() => {\r\n        this.isShowCmtBox = true;\r\n      }, 0);\r\n    },\r\n\r\n    // 发布按钮-点击事件\r\n    async sendFn() {\r\n      //   console.log(this.comText);\r\n      const res = await commentSendAPI({\r\n        id: this.$route.query.art_id,\r\n        content: this.comText\r\n      });\r\n      console.log(res);\r\n      this.commentArr.unshift(res.data.data.new_obj);\r\n      this.totalCount++;\r\n      this.comText = \"\";\r\n      this.commentClickFn(); //滚到到第一条评论处\r\n    },\r\n    // 加载更多评论\r\n    async onLoad() {\r\n      if (this.commentArr.length > 0) {\r\n        const res = await commentsListAPI({\r\n          id: this.$route.query.art_id, //文章id\r\n          offset: this.lastId\r\n        });\r\n        // console.log(res);\r\n        this.commentArr = [...this.commentArr, ...res.data.data.results];\r\n        this.totalCount = res.data.data.total_count;\r\n        this.lastId = res.data.data.last_id; //用于分页\r\n        if (this.lastId === null) {\r\n          //   没有下一页了\r\n          this.finished = true;\r\n        }\r\n        this.loading = false;\r\n      } else {\r\n        this.loading = false;\r\n      }\r\n    }\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.cmt-list {\r\n  padding: 10px;\r\n  .cmt-item {\r\n    padding: 15px 0;\r\n    .cmt-item {\r\n      border-top: 1px solid #f8f8f8;\r\n    }\r\n    .cmt-header {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      .cmt-header-left {\r\n        display: flex;\r\n        align-items: center;\r\n        .avatar {\r\n          width: 40px;\r\n          height: 40px;\r\n          background-color: #f8f8f8;\r\n          border-radius: 50%;\r\n          margin-right: 15px;\r\n        }\r\n        .uname {\r\n          font-size: 12px;\r\n        }\r\n      }\r\n    }\r\n    .cmt-body {\r\n      font-size: 14px;\r\n      line-height: 28px;\r\n      text-indent: 2em;\r\n      margin-top: 6px;\r\n      word-break: break-all;\r\n    }\r\n    .cmt-footer {\r\n      font-size: 12px;\r\n      color: gray;\r\n      margin-top: 10px;\r\n    }\r\n  }\r\n}\r\n\r\n// 评论区域样式\r\n.art-cmt-container-1 {\r\n  padding-bottom: 76px;\r\n}\r\n.art-cmt-container-2 {\r\n  padding-bottom: 80px;\r\n}\r\n\r\n// 发布评论盒子--1\r\n.add-cmt-box {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  background-color: white;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  height: 76px;\r\n  line-height: 46px;\r\n  padding-left: 10px;\r\n  .ipt-cmt-div {\r\n    flex: 1;\r\n    border: 1px solid #efefef;\r\n    border-radius: 15px;\r\n    height: 30px;\r\n    font-size: 12px;\r\n    line-height: 30px;\r\n    padding-left: 15px;\r\n    margin-left: 10px;\r\n    background-color: #f8f8f8;\r\n  }\r\n  .icon-box {\r\n    width: 50%;\r\n    display: flex;\r\n    justify-content: space-evenly;\r\n    line-height: 0;\r\n  }\r\n}\r\n.child {\r\n  width: 20px;\r\n  height: 20px;\r\n  background: #f2f3f5;\r\n}\r\n\r\n// 发表评论的盒子---2\r\n.cmt-box {\r\n  position: fixed;\r\n  bottom: 0;\r\n  left: 0;\r\n  width: 100%;\r\n  height: 80px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  font-size: 12px;\r\n  padding-left: 10px;\r\n  box-sizing: border-box;\r\n  background-color: white;\r\n  textarea {\r\n    flex: 1;\r\n    height: 66%;\r\n    border: 1px solid #efefef;\r\n    background-color: #f8f8f8;\r\n    resize: none;\r\n    border-radius: 6px;\r\n    padding: 5px;\r\n  }\r\n  .van-button {\r\n    height: 100%;\r\n    border: none;\r\n  }\r\n}\r\n</style>"]}]}
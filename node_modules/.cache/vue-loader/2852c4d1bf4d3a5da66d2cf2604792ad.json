{"remainingRequest":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue?vue&type=style&index=0&id=9a035be2&lang=less&scoped=true&","dependencies":[{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue","mtime":1666937178287},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\css-loader\\dist\\cjs.js","mtime":1664795354518},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1664795355419},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\postcss-loader\\src\\index.js","mtime":1614782079830},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\less-loader\\dist\\cjs.js","mtime":1664094124859},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoudXNlci1lZGl0LWNvbnRhaW5lciB7DQogIHBhZGRpbmctdG9wOiA0NnB4Ow0KICAuYXZhdGFyIHsNCiAgICB3aWR0aDogNTBweDsNCiAgICBoZWlnaHQ6IDUwcHg7DQogIH0NCn0NCi9kZWVwLyAudmFuLWRpYWxvZ19fY29udGVudCB7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgaW5wdXQgew0KICAgIHBhZGRpbmc6IDA7DQogICAgYm9yZGVyOiBub25lOw0KICAgIG91dGxpbmU6IG5vbmU7DQogICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICB9DQp9DQo="},{"version":3,"sources":["UserEdit.vue"],"names":[],"mappings":";AAoIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserEdit.vue","sourceRoot":"src/views/User","sourcesContent":["<template>\r\n  <div class=\"user-edit-container\">\r\n    <!-- Header区域 -->\r\n    <van-nav-bar title=\"编辑资料\" left-arrow @click-left=\"$router.back()\"></van-nav-bar>\r\n\r\n    <!-- 用户资料 -->\r\n    <van-cell-group class=\"action-card\">\r\n      <van-cell title=\"头像\" is-link center>\r\n        <template #default>\r\n          <van-image round class=\"avatar\" :src=\"profileObj.photo\" @click=\"imageClickFn\"></van-image>\r\n          <!-- file选择框 -->\r\n          <input type=\"file\" ref=\"iptFile\" v-show=\"false\" accept=\"image/*\" @change=\"onFileChange\" />\r\n        </template>\r\n      </van-cell>\r\n      <van-cell title=\"名称\" is-link :value=\"profileObj.name\" @click=\"nameClickFn\"></van-cell>\r\n\r\n      <!-- 修改名称确认弹出框 -->\r\n      <van-dialog v-model=\"show\" title=\"标题\" show-cancel-button :before-close=\"beforeCloseFn\">\r\n        <input type=\"text\" v-model=\"inputUserName\" v-fofo />\r\n      </van-dialog>\r\n      <van-cell title=\"生日\" is-link :value=\"profileObj.birthday\" @click=\"birthdayClickFn\"></van-cell>\r\n\r\n      <!-- 时间选择器 -->\r\n      <van-popup v-model=\"dateTimePickerShow\" round position=\"bottom\" :style=\"{ height: '50%'}\">\r\n        <van-datetime-picker\r\n          v-model=\"currentDate\"\r\n          type=\"date\"\r\n          title=\"选择年月日\"\r\n          :min-date=\"minDate\"\r\n          :max-date=\"maxDate\"\r\n          @cancel=\"dateCancelFn\"\r\n          @confirm=\"confirmFn\"\r\n        />\r\n      </van-popup>\r\n    </van-cell-group>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  userProfileAPI,\r\n  updateUserPhotoAPI,\r\n  updateUserProfileAPI\r\n} from \"@/api\";\r\nimport { Notify } from \"vant\";\r\nimport { formateDate } from \"@/utils/dayjs.js\";\r\nexport default {\r\n  name: \"UserEdit\",\r\n  data() {\r\n    return {\r\n      profileObj: {}, //用户基本资料对象\r\n      show: false, //控制姓名修改弹出框的显示与隐藏\r\n      inputUserName: \"\", //修改姓名输入框的绑定值\r\n      minDate: new Date(1920, 0, 1), //最小范围\r\n      maxDate: new Date(), //最大范围\r\n      currentDate: new Date(), //当前时间\r\n      dateTimePickerShow: false\r\n    };\r\n  },\r\n  async created() {\r\n    const res = await userProfileAPI();\r\n    // console.log(res);\r\n    this.profileObj = res.data.data;\r\n  },\r\n  methods: {\r\n    // 文件选择改变-事件\r\n    async onFileChange(e) {\r\n      // console.log(e.target.files[0]);\r\n      // 用户没有选择图片，阻止代码往下运行\r\n      if (e.target.files.length === 0) {\r\n        return;\r\n      }\r\n      const theFd = new FormData();\r\n      theFd.append(\"photo\", e.target.files[0]); //请求体里加入获取到的图片\r\n\r\n      const res = await updateUserPhotoAPI(theFd);\r\n      // console.log(res);\r\n      this.profileObj.photo = res.data.data.photo;\r\n    },\r\n    // 修改头像\r\n    imageClickFn() {\r\n      // 模拟标签的点击事件\r\n      this.$refs.iptFile.click();\r\n    },\r\n    // 修改名称\r\n    nameClickFn() {\r\n      this.show = true;\r\n      this.inputUserName = this.profileObj.name;\r\n    },\r\n    // 关闭弹框前的操作\r\n    async beforeCloseFn(action, done) {\r\n      if (action === \"confirm\") {\r\n        // 点了确定\r\n        const reg = /^[a-zA-Z0-9\\u4e00-\\u9fa5]{1,7}$/;\r\n        if (reg.test(this.inputUserName) === true) {\r\n          // 通过校验\r\n          await updateUserProfileAPI({\r\n            name: this.inputUserName\r\n          });\r\n          this.profileObj.name = this.inputUserName; //更新成功--数据回显页面上\r\n          done();\r\n        } else {\r\n          // 没通过校验\r\n          Notify({ type: \"warning\", message: \"请输入1-7位的中英数字\" });\r\n          done(false);\r\n        }\r\n      } else {\r\n        // 点取消\r\n        done(); //让弹窗关闭\r\n      }\r\n    },\r\n    // 显示用户生日-生日单元格\r\n    birthdayClickFn() {\r\n      this.dateTimePickerShow = true;\r\n      this.currentDate = new Date(this.profileObj.birthday);\r\n    },\r\n    // 日期选择器-取消事件\r\n    dateCancelFn() {\r\n      this.dateTimePickerShow = false;\r\n    },\r\n    async confirmFn() {\r\n      // 日期选择器组件里是日期对象，而后台要的是年-月-日字符串\r\n      await updateUserProfileAPI({\r\n        birthday: formateDate(this.currentDate)\r\n      });\r\n      this.dateTimePickerShow = false;\r\n      this.profileObj.birthday = formateDate(this.currentDate); //数据回显到页面\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.user-edit-container {\r\n  padding-top: 46px;\r\n  .avatar {\r\n    width: 50px;\r\n    height: 50px;\r\n  }\r\n}\r\n/deep/ .van-dialog__content {\r\n  text-align: center;\r\n  input {\r\n    padding: 0;\r\n    border: none;\r\n    outline: none;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>"]}]}
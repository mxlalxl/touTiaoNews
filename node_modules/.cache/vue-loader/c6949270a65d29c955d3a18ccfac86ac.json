{"remainingRequest":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\src\\views\\User\\UserEdit.vue","mtime":1667379873340},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\new vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgew0KICB1c2VyUHJvZmlsZUFQSSwNCiAgdXBkYXRlVXNlclBob3RvQVBJLA0KICB1cGRhdGVVc2VyUHJvZmlsZUFQSQ0KfSBmcm9tICJAL2FwaSI7DQppbXBvcnQgTm90aWZ5IGZyb20gIkAvdWkvTm90aWZ5LmpzIjsNCmltcG9ydCB7IGZvcm1hdGVEYXRlIH0gZnJvbSAiQC91dGlscy9kYXlqcy5qcyI7DQpleHBvcnQgZGVmYXVsdCB7DQogIG5hbWU6ICJVc2VyRWRpdCIsDQogIGRhdGEoKSB7DQogICAgcmV0dXJuIHsNCiAgICAgIHByb2ZpbGVPYmo6IHt9LCAvL+eUqOaIt+WfuuacrOi1hOaWmeWvueixoQ0KICAgICAgc2hvdzogZmFsc2UsIC8v5o6n5Yi25aeT5ZCN5L+u5pS55by55Ye65qGG55qE5pi+56S65LiO6ZqQ6JePDQogICAgICBpbnB1dFVzZXJOYW1lOiAiIiwgLy/kv67mlLnlp5PlkI3ovpPlhaXmoYbnmoTnu5HlrprlgLwNCiAgICAgIG1pbkRhdGU6IG5ldyBEYXRlKDE5MjAsIDAsIDEpLCAvL+acgOWwj+iMg+WbtA0KICAgICAgbWF4RGF0ZTogbmV3IERhdGUoKSwgLy/mnIDlpKfojIPlm7QNCiAgICAgIGN1cnJlbnREYXRlOiBuZXcgRGF0ZSgpLCAvL+W9k+WJjeaXtumXtA0KICAgICAgZGF0ZVRpbWVQaWNrZXJTaG93OiBmYWxzZQ0KICAgIH07DQogIH0sDQogIGFzeW5jIGNyZWF0ZWQoKSB7DQogICAgY29uc3QgcmVzID0gYXdhaXQgdXNlclByb2ZpbGVBUEkoKTsNCiAgICAvLyBjb25zb2xlLmxvZyhyZXMpOw0KICAgIHRoaXMucHJvZmlsZU9iaiA9IHJlcy5kYXRhLmRhdGE7DQogIH0sDQogIG1ldGhvZHM6IHsNCiAgICAvLyDmlofku7bpgInmi6nmlLnlj5gt5LqL5Lu2DQogICAgYXN5bmMgb25GaWxlQ2hhbmdlKGUpIHsNCiAgICAgIC8vIGNvbnNvbGUubG9nKGUudGFyZ2V0LmZpbGVzWzBdKTsNCiAgICAgIC8vIOeUqOaIt+ayoeaciemAieaLqeWbvueJh++8jOmYu+atouS7o+eggeW+gOS4i+i/kOihjA0KICAgICAgaWYgKGUudGFyZ2V0LmZpbGVzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgICBjb25zdCB0aGVGZCA9IG5ldyBGb3JtRGF0YSgpOw0KICAgICAgdGhlRmQuYXBwZW5kKCJwaG90byIsIGUudGFyZ2V0LmZpbGVzWzBdKTsgLy/or7fmsYLkvZPph4zliqDlhaXojrflj5bliLDnmoTlm77niYcNCg0KICAgICAgY29uc3QgcmVzID0gYXdhaXQgdXBkYXRlVXNlclBob3RvQVBJKHRoZUZkKTsNCiAgICAgIC8vIGNvbnNvbGUubG9nKHJlcyk7DQogICAgICB0aGlzLnByb2ZpbGVPYmoucGhvdG8gPSByZXMuZGF0YS5kYXRhLnBob3RvOw0KICAgIH0sDQogICAgLy8g5L+u5pS55aS05YOPDQogICAgaW1hZ2VDbGlja0ZuKCkgew0KICAgICAgLy8g5qih5ouf5qCH562+55qE54K55Ye75LqL5Lu2DQogICAgICB0aGlzLiRyZWZzLmlwdEZpbGUuY2xpY2soKTsNCiAgICB9LA0KICAgIC8vIOS/ruaUueWQjeensA0KICAgIG5hbWVDbGlja0ZuKCkgew0KICAgICAgdGhpcy5zaG93ID0gdHJ1ZTsNCiAgICAgIHRoaXMuaW5wdXRVc2VyTmFtZSA9IHRoaXMucHJvZmlsZU9iai5uYW1lOw0KICAgIH0sDQogICAgLy8g5YWz6Zet5by55qGG5YmN55qE5pON5L2cDQogICAgYXN5bmMgYmVmb3JlQ2xvc2VGbihhY3Rpb24sIGRvbmUpIHsNCiAgICAgIGlmIChhY3Rpb24gPT09ICJjb25maXJtIikgew0KICAgICAgICAvLyDngrnkuobnoa7lrpoNCiAgICAgICAgY29uc3QgcmVnID0gL15bYS16QS1aMC05XHU0ZTAwLVx1OWZhNV17MSw3fSQvOw0KICAgICAgICBpZiAocmVnLnRlc3QodGhpcy5pbnB1dFVzZXJOYW1lKSA9PT0gdHJ1ZSkgew0KICAgICAgICAgIC8vIOmAmui/h+agoemqjA0KICAgICAgICAgIGF3YWl0IHVwZGF0ZVVzZXJQcm9maWxlQVBJKHsNCiAgICAgICAgICAgIG5hbWU6IHRoaXMuaW5wdXRVc2VyTmFtZQ0KICAgICAgICAgIH0pOw0KICAgICAgICAgIHRoaXMucHJvZmlsZU9iai5uYW1lID0gdGhpcy5pbnB1dFVzZXJOYW1lOyAvL+abtOaWsOaIkOWKny0t5pWw5o2u5Zue5pi+6aG16Z2i5LiKDQogICAgICAgICAgZG9uZSgpOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIC8vIOayoemAmui/h+agoemqjA0KICAgICAgICAgIE5vdGlmeSh7IHR5cGU6ICJ3YXJuaW5nIiwgbWVzc2FnZTogIuivt+i+k+WFpTEtN+S9jeeahOS4reiLseaVsOWtlyIgfSk7DQogICAgICAgICAgZG9uZShmYWxzZSk7DQogICAgICAgIH0NCiAgICAgIH0gZWxzZSB7DQogICAgICAgIC8vIOeCueWPlua2iA0KICAgICAgICBkb25lKCk7IC8v6K6p5by556qX5YWz6ZetDQogICAgICB9DQogICAgfSwNCiAgICAvLyDmmL7npLrnlKjmiLfnlJ/ml6Ut55Sf5pel5Y2V5YWD5qC8DQogICAgYmlydGhkYXlDbGlja0ZuKCkgew0KICAgICAgdGhpcy5kYXRlVGltZVBpY2tlclNob3cgPSB0cnVlOw0KICAgICAgdGhpcy5jdXJyZW50RGF0ZSA9IG5ldyBEYXRlKHRoaXMucHJvZmlsZU9iai5iaXJ0aGRheSk7DQogICAgfSwNCiAgICAvLyDml6XmnJ/pgInmi6nlmagt5Y+W5raI5LqL5Lu2DQogICAgZGF0ZUNhbmNlbEZuKCkgew0KICAgICAgdGhpcy5kYXRlVGltZVBpY2tlclNob3cgPSBmYWxzZTsNCiAgICB9LA0KICAgIGFzeW5jIGNvbmZpcm1GbigpIHsNCiAgICAgIC8vIOaXpeacn+mAieaLqeWZqOe7hOS7tumHjOaYr+aXpeacn+Wvueixoe+8jOiAjOWQjuWPsOimgeeahOaYr+W5tC3mnIgt5pel5a2X56ym5LiyDQogICAgICBhd2FpdCB1cGRhdGVVc2VyUHJvZmlsZUFQSSh7DQogICAgICAgIGJpcnRoZGF5OiBmb3JtYXRlRGF0ZSh0aGlzLmN1cnJlbnREYXRlKQ0KICAgICAgfSk7DQogICAgICB0aGlzLmRhdGVUaW1lUGlja2VyU2hvdyA9IGZhbHNlOw0KICAgICAgdGhpcy5wcm9maWxlT2JqLmJpcnRoZGF5ID0gZm9ybWF0ZURhdGUodGhpcy5jdXJyZW50RGF0ZSk7IC8v5pWw5o2u5Zue5pi+5Yiw6aG16Z2iDQogICAgfQ0KICB9DQp9Ow0K"},{"version":3,"sources":["UserEdit.vue"],"names":[],"mappings":";AAsCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserEdit.vue","sourceRoot":"src/views/User","sourcesContent":["<template>\r\n  <div class=\"user-edit-container\">\r\n    <!-- Header区域 -->\r\n    <van-nav-bar title=\"编辑资料\" left-arrow @click-left=\"$router.back()\"></van-nav-bar>\r\n\r\n    <!-- 用户资料 -->\r\n    <van-cell-group class=\"action-card\">\r\n      <van-cell title=\"头像\" is-link center>\r\n        <template #default>\r\n          <van-image round class=\"avatar\" :src=\"profileObj.photo\" @click=\"imageClickFn\"></van-image>\r\n          <!-- file选择框 -->\r\n          <input type=\"file\" ref=\"iptFile\" v-show=\"false\" accept=\"image/*\" @change=\"onFileChange\" />\r\n        </template>\r\n      </van-cell>\r\n      <van-cell title=\"名称\" is-link :value=\"profileObj.name\" @click=\"nameClickFn\"></van-cell>\r\n\r\n      <!-- 修改名称确认弹出框 -->\r\n      <van-dialog v-model=\"show\" title=\"标题\" show-cancel-button :before-close=\"beforeCloseFn\">\r\n        <input type=\"text\" v-model=\"inputUserName\" v-fofo />\r\n      </van-dialog>\r\n      <van-cell title=\"生日\" is-link :value=\"profileObj.birthday\" @click=\"birthdayClickFn\"></van-cell>\r\n\r\n      <!-- 时间选择器 -->\r\n      <van-popup v-model=\"dateTimePickerShow\" round position=\"bottom\" :style=\"{ height: '50%'}\">\r\n        <van-datetime-picker\r\n          v-model=\"currentDate\"\r\n          type=\"date\"\r\n          title=\"选择年月日\"\r\n          :min-date=\"minDate\"\r\n          :max-date=\"maxDate\"\r\n          @cancel=\"dateCancelFn\"\r\n          @confirm=\"confirmFn\"\r\n        />\r\n      </van-popup>\r\n    </van-cell-group>\r\n  </div>\r\n</template>\r\n<script>\r\nimport {\r\n  userProfileAPI,\r\n  updateUserPhotoAPI,\r\n  updateUserProfileAPI\r\n} from \"@/api\";\r\nimport Notify from \"@/ui/Notify.js\";\r\nimport { formateDate } from \"@/utils/dayjs.js\";\r\nexport default {\r\n  name: \"UserEdit\",\r\n  data() {\r\n    return {\r\n      profileObj: {}, //用户基本资料对象\r\n      show: false, //控制姓名修改弹出框的显示与隐藏\r\n      inputUserName: \"\", //修改姓名输入框的绑定值\r\n      minDate: new Date(1920, 0, 1), //最小范围\r\n      maxDate: new Date(), //最大范围\r\n      currentDate: new Date(), //当前时间\r\n      dateTimePickerShow: false\r\n    };\r\n  },\r\n  async created() {\r\n    const res = await userProfileAPI();\r\n    // console.log(res);\r\n    this.profileObj = res.data.data;\r\n  },\r\n  methods: {\r\n    // 文件选择改变-事件\r\n    async onFileChange(e) {\r\n      // console.log(e.target.files[0]);\r\n      // 用户没有选择图片，阻止代码往下运行\r\n      if (e.target.files.length === 0) {\r\n        return;\r\n      }\r\n      const theFd = new FormData();\r\n      theFd.append(\"photo\", e.target.files[0]); //请求体里加入获取到的图片\r\n\r\n      const res = await updateUserPhotoAPI(theFd);\r\n      // console.log(res);\r\n      this.profileObj.photo = res.data.data.photo;\r\n    },\r\n    // 修改头像\r\n    imageClickFn() {\r\n      // 模拟标签的点击事件\r\n      this.$refs.iptFile.click();\r\n    },\r\n    // 修改名称\r\n    nameClickFn() {\r\n      this.show = true;\r\n      this.inputUserName = this.profileObj.name;\r\n    },\r\n    // 关闭弹框前的操作\r\n    async beforeCloseFn(action, done) {\r\n      if (action === \"confirm\") {\r\n        // 点了确定\r\n        const reg = /^[a-zA-Z0-9\\u4e00-\\u9fa5]{1,7}$/;\r\n        if (reg.test(this.inputUserName) === true) {\r\n          // 通过校验\r\n          await updateUserProfileAPI({\r\n            name: this.inputUserName\r\n          });\r\n          this.profileObj.name = this.inputUserName; //更新成功--数据回显页面上\r\n          done();\r\n        } else {\r\n          // 没通过校验\r\n          Notify({ type: \"warning\", message: \"请输入1-7位的中英数字\" });\r\n          done(false);\r\n        }\r\n      } else {\r\n        // 点取消\r\n        done(); //让弹窗关闭\r\n      }\r\n    },\r\n    // 显示用户生日-生日单元格\r\n    birthdayClickFn() {\r\n      this.dateTimePickerShow = true;\r\n      this.currentDate = new Date(this.profileObj.birthday);\r\n    },\r\n    // 日期选择器-取消事件\r\n    dateCancelFn() {\r\n      this.dateTimePickerShow = false;\r\n    },\r\n    async confirmFn() {\r\n      // 日期选择器组件里是日期对象，而后台要的是年-月-日字符串\r\n      await updateUserProfileAPI({\r\n        birthday: formateDate(this.currentDate)\r\n      });\r\n      this.dateTimePickerShow = false;\r\n      this.profileObj.birthday = formateDate(this.currentDate); //数据回显到页面\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.user-edit-container {\r\n  padding-top: 46px;\r\n  .avatar {\r\n    width: 50px;\r\n    height: 50px;\r\n  }\r\n}\r\n/deep/ .van-dialog__content {\r\n  text-align: center;\r\n  input {\r\n    padding: 0;\r\n    border: none;\r\n    outline: none;\r\n    text-align: center;\r\n  }\r\n}\r\n</style>"]}]}
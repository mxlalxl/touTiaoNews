{"remainingRequest":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\Chat\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\Chat\\index.vue","mtime":1667113831018},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\babel-loader\\lib\\index.js","mtime":1663989856865},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQppbXBvcnQgeyBpbyB9IGZyb20gInNvY2tldC5pby1jbGllbnQiOw0KaW1wb3J0IHsgZ2V0VG9rZW4gfSBmcm9tICJAL3V0aWxzL3Rva2VuLmpzIjsNCmV4cG9ydCBkZWZhdWx0IHsNCiAgbmFtZTogIkNoYXQiLA0KICBkYXRhKCkgew0KICAgIHJldHVybiB7DQogICAgICB3b3JkOiAiIiwgLy/ovpPlhaXmoYbnmoTlhoXlrrkNCiAgICAgIGxpc3Q6IFsNCiAgICAgICAgLy8g5qC55o2ubmFtZeWxnuaAp++8jOWIpOaWrea2iOaBr+W6lOivpea4suafk+WcqOWTquS4qmRpdg0KICAgICAgICB7IG5hbWU6ICJ4cyIsIG1zZzogImhpLOS9oOWlve+8geaIkeaYr+Wwj+aAnSIgfSwNCiAgICAgICAgeyBuYW1lOiAibWUiLCBtc2c6ICLmiJHmmK/nvJbnqIvlsI/njovlrZAiIH0NCiAgICAgIF0sDQogICAgICBzb2NrZXQ6IG51bGwgLy/lrqLmiLfnq6/lkozmnI3liqHlmajnq6/lu7rnq4vov57mjqXnmoRzb2NrZXTlr7nosaENCiAgICB9Ow0KICB9LA0KICBjcmVhdGVkKCkgew0KICAgIHRoaXMuc29ja2V0ID0gaW8oImh0dHA6Ly90b3V0aWFvLml0aGVpbWEubmV0Iiwgew0KICAgICAgcXVlcnk6IHsNCiAgICAgICAgdG9rZW46IGdldFRva2VuKCkNCiAgICAgIH0sDQogICAgICB0cmFuc3BvcnRzOiBbIndlYnNvY2tldCJdDQogICAgfSk7DQoNCiAgICAvLyDmtYvor5Xov57mjqXmmK/lkKblu7rnq4vmiJDlip8NCiAgICB0aGlzLnNvY2tldC5vbigiY29ubmVjdCIsICgpID0+IHsNCiAgICAgIGNvbnNvbGUubG9nKCLov57mjqXmiJDlip8iKTsNCiAgICB9KTsNCiAgICAvLyDmjqXmlLbmnI3liqHlmajkvKDlm57mnaXnmoTmtojmga8NCiAgICB0aGlzLnNvY2tldC5vbigibWVzc2FnZSIsIG9iaiA9PiB7DQogICAgICAvLyBjb25zb2xlLmxvZyhvYmopOw0KICAgICAgLy8g56uL5Yi76Zi75q2i55u45ZCM5a2X5q615a+56LGh5pS+5Yiw5pWw57uE6YeMLS3jgIt2LWZvcuabtOaWsA0KICAgICAgdGhpcy5saXN0LnB1c2goew0KICAgICAgICBuYW1lOiAieHMiLA0KICAgICAgICBtc2c6IG9iai5tc2cNCiAgICAgIH0pOw0KDQogICAgICAvLyDmnIDlkI7kuIDmnaHogYrlpKnmtojmga/mu5rliqjliLDlsY/luZXojIPlm7QNCiAgICAgIC8vIOaVsOaNruWPmOWMli3jgItET03mm7TmlrDmmK/lvILmraXnmoTvvIzmiYDku6Xojrflj5bnmoTmmK/kuIrkuIDmnaENCiAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsNCiAgICAgICAgY29uc3QgdGhlRGl2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigiLmNoYXQtbGlzdD5kaXY6bGFzdC1jaGlsZCIpOw0KICAgICAgICB0aGVEaXYuc2Nyb2xsSW50b1ZpZXcoew0KICAgICAgICAgIGJlaGF2aW9yOiAic21vb3RoIg0KICAgICAgICB9KTsNCiAgICAgIH0pOw0KICAgIH0pOw0KICB9LA0KICBtZXRob2RzOiB7DQogICAgLy8g5Y+R6YCB5raI5oGvLeeCueWHu+S6i+S7tg0KICAgIHNlbmRGbigpIHsNCiAgICAgIGlmICh0aGlzLndvcmQudHJpbSgpLmxlbmd0aCA9PT0gMCkgcmV0dXJuOw0KICAgICAgLy8gc29ja2V06ZO+5o6l5a+56LGhLmVtaXQoJ+WQjuerr+aOpeaUtua2iOaBr+eahOS6i+S7tuWQjSfvvIwg5YC8KQ0KICAgICAgdGhpcy5zb2NrZXQuZW1pdCgibWVzc2FnZSIsIHsNCiAgICAgICAgbXNnOiB0aGlzLndvcmQsDQogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS5nZXRUaW1lKCkNCiAgICAgIH0pOw0KICAgICAgLy8g5oqK5raI5oGv5pi+56S65Yiw5a+56K+d5qGGDQogICAgICB0aGlzLmxpc3QucHVzaCh7DQogICAgICAgIG1zZzogdGhpcy53b3JkLA0KICAgICAgICBuYW1lOiAibWUiDQogICAgICB9KTsNCg0KICAgICAgLy8g5pyA5ZCO5LiA5p2h6IGK5aSp5raI5oGv5rua5Yqo5Yiw5bGP5bmV6IyD5Zu0DQogICAgICAvLyDmlbDmja7lj5jljJYt44CLRE9N5pu05paw5piv5byC5q2l55qE77yM5omA5Lul6I635Y+W55qE5piv5LiK5LiA5p2hDQogICAgICB0aGlzLiRuZXh0VGljaygoKSA9PiB7DQogICAgICAgIGNvbnN0IHRoZURpdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoIi5jaGF0LWxpc3Q+ZGl2Omxhc3QtY2hpbGQiKTsNCiAgICAgICAgdGhlRGl2LnNjcm9sbEludG9WaWV3KHsNCiAgICAgICAgICBiZWhhdmlvcjogInNtb290aCINCiAgICAgICAgfSk7DQogICAgICB9KTsNCg0KICAgICAgLy8g5riF56m66L6T5YWl5qGGDQogICAgICB0aGlzLndvcmQgPSAiIjsNCiAgICAgIC8vIGNvbnNvbGUubG9nKCIxMTEiKTsNCiAgICB9DQogIH0sDQogIGRlc3Ryb3llZCgpIHsNCiAgICB0aGlzLnNvY2tldC5jbG9zZSgpOw0KICAgIHRoaXMuc29ja2V0ID0gbnVsbDsNCiAgfQ0KfTsNCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Chat","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!-- 固定导航 -->\r\n    <van-nav-bar fixed left-arrow @click-left=\"$router.back()\" title=\"小思同学\" class=\"xiaosi\"></van-nav-bar>\r\n    <!-- 聊天主体区域 -->\r\n    <div class=\"chat-list\">\r\n      <div v-for=\"(obj,index) in list\" :key=\"index\">\r\n        <!-- 左侧-机器人小思 -->\r\n        <div class=\"chat-item left\" v-if=\"obj.name !== 'me'\">\r\n          <van-image fit=\"cover\" round src=\"https://img.yzcdn.cn/vant/cat.jpeg\"></van-image>\r\n          <div class=\"chat-pao\">{{obj.msg}}</div>\r\n        </div>\r\n\r\n        <!-- 右侧-当前用户 -->\r\n        <div class=\"chat-item right\" v-else>\r\n          <div class=\"chat-pao\">{{obj.msg}}</div>\r\n          <van-image fit=\"cover\" round :src=\"$store.state.userPhoto\"></van-image>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 对话区域 -->\r\n    <div class=\"reply-container van-hairline--top\">\r\n      <van-field placeholder=\"说点什么...\" v-model=\"word\">\r\n        <template #button>\r\n          <span style=\"font-size:18px;color:#999\" @click=\"sendFn\">提交</span>\r\n        </template>\r\n      </van-field>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { io } from \"socket.io-client\";\r\nimport { getToken } from \"@/utils/token.js\";\r\nexport default {\r\n  name: \"Chat\",\r\n  data() {\r\n    return {\r\n      word: \"\", //输入框的内容\r\n      list: [\r\n        // 根据name属性，判断消息应该渲染在哪个div\r\n        { name: \"xs\", msg: \"hi,你好！我是小思\" },\r\n        { name: \"me\", msg: \"我是编程小王子\" }\r\n      ],\r\n      socket: null //客户端和服务器端建立连接的socket对象\r\n    };\r\n  },\r\n  created() {\r\n    this.socket = io(\"http://toutiao.itheima.net\", {\r\n      query: {\r\n        token: getToken()\r\n      },\r\n      transports: [\"websocket\"]\r\n    });\r\n\r\n    // 测试连接是否建立成功\r\n    this.socket.on(\"connect\", () => {\r\n      console.log(\"连接成功\");\r\n    });\r\n    // 接收服务器传回来的消息\r\n    this.socket.on(\"message\", obj => {\r\n      // console.log(obj);\r\n      // 立刻阻止相同字段对象放到数组里--》v-for更新\r\n      this.list.push({\r\n        name: \"xs\",\r\n        msg: obj.msg\r\n      });\r\n\r\n      // 最后一条聊天消息滚动到屏幕范围\r\n      // 数据变化-》DOM更新是异步的，所以获取的是上一条\r\n      this.$nextTick(() => {\r\n        const theDiv = document.querySelector(\".chat-list>div:last-child\");\r\n        theDiv.scrollIntoView({\r\n          behavior: \"smooth\"\r\n        });\r\n      });\r\n    });\r\n  },\r\n  methods: {\r\n    // 发送消息-点击事件\r\n    sendFn() {\r\n      if (this.word.trim().length === 0) return;\r\n      // socket链接对象.emit('后端接收消息的事件名'， 值)\r\n      this.socket.emit(\"message\", {\r\n        msg: this.word,\r\n        timestamp: new Date().getTime()\r\n      });\r\n      // 把消息显示到对话框\r\n      this.list.push({\r\n        msg: this.word,\r\n        name: \"me\"\r\n      });\r\n\r\n      // 最后一条聊天消息滚动到屏幕范围\r\n      // 数据变化-》DOM更新是异步的，所以获取的是上一条\r\n      this.$nextTick(() => {\r\n        const theDiv = document.querySelector(\".chat-list>div:last-child\");\r\n        theDiv.scrollIntoView({\r\n          behavior: \"smooth\"\r\n        });\r\n      });\r\n\r\n      // 清空输入框\r\n      this.word = \"\";\r\n      // console.log(\"111\");\r\n    }\r\n  },\r\n  destroyed() {\r\n    this.socket.close();\r\n    this.socket = null;\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.container {\r\n  height: 100%;\r\n  width: 100%;\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  box-sizing: border-box;\r\n  background: #fafafa;\r\n  padding: 46px 0 50px 0;\r\n  // /deep/ .van-nav-bar__content {\r\n  //   margin-bottom: 15px;\r\n  // }\r\n  .chat-list {\r\n    height: 100%;\r\n    overflow-y: scroll;\r\n    padding-top: 35px;\r\n    padding-bottom: 65px;\r\n    .chat-item {\r\n      padding: 10px;\r\n      /deep/ .van-image__img {\r\n        vertical-align: top;\r\n        width: 60px;\r\n        height: 60px;\r\n      }\r\n      .chat-pao {\r\n        vertical-align: top;\r\n        display: inline-block;\r\n        margin-top: 10px !important;\r\n        min-width: 40px;\r\n        max-width: 70%;\r\n        min-height: 40px;\r\n        line-height: 45px;\r\n        border: 0.5px solid #c2d9ea;\r\n        border-radius: 4px;\r\n        position: relative;\r\n        padding: 0 10px;\r\n        background-color: #e0effb;\r\n        word-break: break-all;\r\n        font-size: 14px;\r\n        color: #333;\r\n        &::before {\r\n          content: \"\";\r\n          width: 10px;\r\n          height: 10px;\r\n          position: absolute;\r\n          top: 12px;\r\n          border-top: 0.5px solid #c2d9ea;\r\n          border-right: 0.5px solid #c2d9ea;\r\n          background: #e0effb;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n.right {\r\n  text-align: right;\r\n  .chat-pao {\r\n    margin-left: 0;\r\n    margin-right: 15px;\r\n    &::before {\r\n      right: -6px;\r\n      transform: rotate(45deg);\r\n    }\r\n  }\r\n}\r\n.left {\r\n  text-align: left;\r\n  .chat-pao {\r\n    margin-left: 15px;\r\n    margin-right: 0;\r\n    &::before {\r\n      left: -5px;\r\n      transform: rotate(-135deg);\r\n    }\r\n  }\r\n}\r\n.reply-container {\r\n  position: fixed;\r\n  left: 0;\r\n  bottom: 0;\r\n  // padding: 0 10px 0 10px;\r\n  // height: 20% !important;\r\n  text-align: center;\r\n  width: 100%;\r\n  background: #f5f5f5;\r\n  z-index: 9999;\r\n}\r\n</style>"]}]}
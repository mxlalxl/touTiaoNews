{"remainingRequest":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\Chat\\index.vue?vue&type=style&index=0&id=e878a8d6&lang=less&scoped=true&","dependencies":[{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\src\\views\\Chat\\index.vue","mtime":1667113831018},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\css-loader\\dist\\cjs.js","mtime":1664795354518},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1664795355419},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\postcss-loader\\src\\index.js","mtime":1614782079830},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\less-loader\\dist\\cjs.js","mtime":1664094124859},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1664795348110},{"path":"D:\\forward\\code\\vue\\hmtt_nnew\\node_modules\\vue-loader\\lib\\index.js","mtime":1664795355419}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouY29udGFpbmVyIHsNCiAgaGVpZ2h0OiAxMDAlOw0KICB3aWR0aDogMTAwJTsNCiAgcG9zaXRpb246IGFic29sdXRlOw0KICBsZWZ0OiAwOw0KICB0b3A6IDA7DQogIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogIGJhY2tncm91bmQ6ICNmYWZhZmE7DQogIHBhZGRpbmc6IDQ2cHggMCA1MHB4IDA7DQogIC8vIC9kZWVwLyAudmFuLW5hdi1iYXJfX2NvbnRlbnQgew0KICAvLyAgIG1hcmdpbi1ib3R0b206IDE1cHg7DQogIC8vIH0NCiAgLmNoYXQtbGlzdCB7DQogICAgaGVpZ2h0OiAxMDAlOw0KICAgIG92ZXJmbG93LXk6IHNjcm9sbDsNCiAgICBwYWRkaW5nLXRvcDogMzVweDsNCiAgICBwYWRkaW5nLWJvdHRvbTogNjVweDsNCiAgICAuY2hhdC1pdGVtIHsNCiAgICAgIHBhZGRpbmc6IDEwcHg7DQogICAgICAvZGVlcC8gLnZhbi1pbWFnZV9faW1nIHsNCiAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgd2lkdGg6IDYwcHg7DQogICAgICAgIGhlaWdodDogNjBweDsNCiAgICAgIH0NCiAgICAgIC5jaGF0LXBhbyB7DQogICAgICAgIHZlcnRpY2FsLWFsaWduOiB0b3A7DQogICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgICAgbWFyZ2luLXRvcDogMTBweCAhaW1wb3J0YW50Ow0KICAgICAgICBtaW4td2lkdGg6IDQwcHg7DQogICAgICAgIG1heC13aWR0aDogNzAlOw0KICAgICAgICBtaW4taGVpZ2h0OiA0MHB4Ow0KICAgICAgICBsaW5lLWhlaWdodDogNDVweDsNCiAgICAgICAgYm9yZGVyOiAwLjVweCBzb2xpZCAjYzJkOWVhOw0KICAgICAgICBib3JkZXItcmFkaXVzOiA0cHg7DQogICAgICAgIHBvc2l0aW9uOiByZWxhdGl2ZTsNCiAgICAgICAgcGFkZGluZzogMCAxMHB4Ow0KICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZTBlZmZiOw0KICAgICAgICB3b3JkLWJyZWFrOiBicmVhay1hbGw7DQogICAgICAgIGZvbnQtc2l6ZTogMTRweDsNCiAgICAgICAgY29sb3I6ICMzMzM7DQogICAgICAgICY6OmJlZm9yZSB7DQogICAgICAgICAgY29udGVudDogIiI7DQogICAgICAgICAgd2lkdGg6IDEwcHg7DQogICAgICAgICAgaGVpZ2h0OiAxMHB4Ow0KICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICB0b3A6IDEycHg7DQogICAgICAgICAgYm9yZGVyLXRvcDogMC41cHggc29saWQgI2MyZDllYTsNCiAgICAgICAgICBib3JkZXItcmlnaHQ6IDAuNXB4IHNvbGlkICNjMmQ5ZWE7DQogICAgICAgICAgYmFja2dyb3VuZDogI2UwZWZmYjsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH0NCiAgfQ0KfQ0KLnJpZ2h0IHsNCiAgdGV4dC1hbGlnbjogcmlnaHQ7DQogIC5jaGF0LXBhbyB7DQogICAgbWFyZ2luLWxlZnQ6IDA7DQogICAgbWFyZ2luLXJpZ2h0OiAxNXB4Ow0KICAgICY6OmJlZm9yZSB7DQogICAgICByaWdodDogLTZweDsNCiAgICAgIHRyYW5zZm9ybTogcm90YXRlKDQ1ZGVnKTsNCiAgICB9DQogIH0NCn0NCi5sZWZ0IHsNCiAgdGV4dC1hbGlnbjogbGVmdDsNCiAgLmNoYXQtcGFvIHsNCiAgICBtYXJnaW4tbGVmdDogMTVweDsNCiAgICBtYXJnaW4tcmlnaHQ6IDA7DQogICAgJjo6YmVmb3JlIHsNCiAgICAgIGxlZnQ6IC01cHg7DQogICAgICB0cmFuc2Zvcm06IHJvdGF0ZSgtMTM1ZGVnKTsNCiAgICB9DQogIH0NCn0NCi5yZXBseS1jb250YWluZXIgew0KICBwb3NpdGlvbjogZml4ZWQ7DQogIGxlZnQ6IDA7DQogIGJvdHRvbTogMDsNCiAgLy8gcGFkZGluZzogMCAxMHB4IDAgMTBweDsNCiAgLy8gaGVpZ2h0OiAyMCUgIWltcG9ydGFudDsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KICB3aWR0aDogMTAwJTsNCiAgYmFja2dyb3VuZDogI2Y1ZjVmNTsNCiAgei1pbmRleDogOTk5OTsNCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAmHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Chat","sourcesContent":["<template>\r\n  <div class=\"container\">\r\n    <!-- 固定导航 -->\r\n    <van-nav-bar fixed left-arrow @click-left=\"$router.back()\" title=\"小思同学\" class=\"xiaosi\"></van-nav-bar>\r\n    <!-- 聊天主体区域 -->\r\n    <div class=\"chat-list\">\r\n      <div v-for=\"(obj,index) in list\" :key=\"index\">\r\n        <!-- 左侧-机器人小思 -->\r\n        <div class=\"chat-item left\" v-if=\"obj.name !== 'me'\">\r\n          <van-image fit=\"cover\" round src=\"https://img.yzcdn.cn/vant/cat.jpeg\"></van-image>\r\n          <div class=\"chat-pao\">{{obj.msg}}</div>\r\n        </div>\r\n\r\n        <!-- 右侧-当前用户 -->\r\n        <div class=\"chat-item right\" v-else>\r\n          <div class=\"chat-pao\">{{obj.msg}}</div>\r\n          <van-image fit=\"cover\" round :src=\"$store.state.userPhoto\"></van-image>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 对话区域 -->\r\n    <div class=\"reply-container van-hairline--top\">\r\n      <van-field placeholder=\"说点什么...\" v-model=\"word\">\r\n        <template #button>\r\n          <span style=\"font-size:18px;color:#999\" @click=\"sendFn\">提交</span>\r\n        </template>\r\n      </van-field>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { io } from \"socket.io-client\";\r\nimport { getToken } from \"@/utils/token.js\";\r\nexport default {\r\n  name: \"Chat\",\r\n  data() {\r\n    return {\r\n      word: \"\", //输入框的内容\r\n      list: [\r\n        // 根据name属性，判断消息应该渲染在哪个div\r\n        { name: \"xs\", msg: \"hi,你好！我是小思\" },\r\n        { name: \"me\", msg: \"我是编程小王子\" }\r\n      ],\r\n      socket: null //客户端和服务器端建立连接的socket对象\r\n    };\r\n  },\r\n  created() {\r\n    this.socket = io(\"http://toutiao.itheima.net\", {\r\n      query: {\r\n        token: getToken()\r\n      },\r\n      transports: [\"websocket\"]\r\n    });\r\n\r\n    // 测试连接是否建立成功\r\n    this.socket.on(\"connect\", () => {\r\n      console.log(\"连接成功\");\r\n    });\r\n    // 接收服务器传回来的消息\r\n    this.socket.on(\"message\", obj => {\r\n      // console.log(obj);\r\n      // 立刻阻止相同字段对象放到数组里--》v-for更新\r\n      this.list.push({\r\n        name: \"xs\",\r\n        msg: obj.msg\r\n      });\r\n\r\n      // 最后一条聊天消息滚动到屏幕范围\r\n      // 数据变化-》DOM更新是异步的，所以获取的是上一条\r\n      this.$nextTick(() => {\r\n        const theDiv = document.querySelector(\".chat-list>div:last-child\");\r\n        theDiv.scrollIntoView({\r\n          behavior: \"smooth\"\r\n        });\r\n      });\r\n    });\r\n  },\r\n  methods: {\r\n    // 发送消息-点击事件\r\n    sendFn() {\r\n      if (this.word.trim().length === 0) return;\r\n      // socket链接对象.emit('后端接收消息的事件名'， 值)\r\n      this.socket.emit(\"message\", {\r\n        msg: this.word,\r\n        timestamp: new Date().getTime()\r\n      });\r\n      // 把消息显示到对话框\r\n      this.list.push({\r\n        msg: this.word,\r\n        name: \"me\"\r\n      });\r\n\r\n      // 最后一条聊天消息滚动到屏幕范围\r\n      // 数据变化-》DOM更新是异步的，所以获取的是上一条\r\n      this.$nextTick(() => {\r\n        const theDiv = document.querySelector(\".chat-list>div:last-child\");\r\n        theDiv.scrollIntoView({\r\n          behavior: \"smooth\"\r\n        });\r\n      });\r\n\r\n      // 清空输入框\r\n      this.word = \"\";\r\n      // console.log(\"111\");\r\n    }\r\n  },\r\n  destroyed() {\r\n    this.socket.close();\r\n    this.socket = null;\r\n  }\r\n};\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.container {\r\n  height: 100%;\r\n  width: 100%;\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  box-sizing: border-box;\r\n  background: #fafafa;\r\n  padding: 46px 0 50px 0;\r\n  // /deep/ .van-nav-bar__content {\r\n  //   margin-bottom: 15px;\r\n  // }\r\n  .chat-list {\r\n    height: 100%;\r\n    overflow-y: scroll;\r\n    padding-top: 35px;\r\n    padding-bottom: 65px;\r\n    .chat-item {\r\n      padding: 10px;\r\n      /deep/ .van-image__img {\r\n        vertical-align: top;\r\n        width: 60px;\r\n        height: 60px;\r\n      }\r\n      .chat-pao {\r\n        vertical-align: top;\r\n        display: inline-block;\r\n        margin-top: 10px !important;\r\n        min-width: 40px;\r\n        max-width: 70%;\r\n        min-height: 40px;\r\n        line-height: 45px;\r\n        border: 0.5px solid #c2d9ea;\r\n        border-radius: 4px;\r\n        position: relative;\r\n        padding: 0 10px;\r\n        background-color: #e0effb;\r\n        word-break: break-all;\r\n        font-size: 14px;\r\n        color: #333;\r\n        &::before {\r\n          content: \"\";\r\n          width: 10px;\r\n          height: 10px;\r\n          position: absolute;\r\n          top: 12px;\r\n          border-top: 0.5px solid #c2d9ea;\r\n          border-right: 0.5px solid #c2d9ea;\r\n          background: #e0effb;\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n.right {\r\n  text-align: right;\r\n  .chat-pao {\r\n    margin-left: 0;\r\n    margin-right: 15px;\r\n    &::before {\r\n      right: -6px;\r\n      transform: rotate(45deg);\r\n    }\r\n  }\r\n}\r\n.left {\r\n  text-align: left;\r\n  .chat-pao {\r\n    margin-left: 15px;\r\n    margin-right: 0;\r\n    &::before {\r\n      left: -5px;\r\n      transform: rotate(-135deg);\r\n    }\r\n  }\r\n}\r\n.reply-container {\r\n  position: fixed;\r\n  left: 0;\r\n  bottom: 0;\r\n  // padding: 0 10px 0 10px;\r\n  // height: 20% !important;\r\n  text-align: center;\r\n  width: 100%;\r\n  background: #f5f5f5;\r\n  z-index: 9999;\r\n}\r\n</style>"]}]}